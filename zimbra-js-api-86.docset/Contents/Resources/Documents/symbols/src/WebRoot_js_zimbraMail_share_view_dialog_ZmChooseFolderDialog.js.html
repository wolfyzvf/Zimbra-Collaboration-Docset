<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class="line">  1</span> <span class="COMM">/*
<span class="line">  2</span>  * ***** BEGIN LICENSE BLOCK *****
<span class="line">  3</span>  * Zimbra Collaboration Suite Web Client
<span class="line">  4</span>  * Copyright (C) 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014 Zimbra, Inc.
<span class="line">  5</span>  * 
<span class="line">  6</span>  * The contents of this file are subject to the Common Public Attribution License Version 1.0 (the &#34;License&#34;);
<span class="line">  7</span>  * you may not use this file except in compliance with the License. 
<span class="line">  8</span>  * You may obtain a copy of the License at: http://www.zimbra.com/license
<span class="line">  9</span>  * The License is based on the Mozilla Public License Version 1.1 but Sections 14 and 15 
<span class="line"> 10</span>  * have been added to cover use of software over a computer network and provide for limited attribution 
<span class="line"> 11</span>  * for the Original Developer. In addition, Exhibit A has been modified to be consistent with Exhibit B. 
<span class="line"> 12</span>  * 
<span class="line"> 13</span>  * Software distributed under the License is distributed on an &#34;AS IS&#34; basis, 
<span class="line"> 14</span>  * WITHOUT WARRANTY OF ANY KIND, either express or implied. 
<span class="line"> 15</span>  * See the License for the specific language governing rights and limitations under the License. 
<span class="line"> 16</span>  * The Original Code is Zimbra Open Source Web Client. 
<span class="line"> 17</span>  * The Initial Developer of the Original Code is Zimbra, Inc. 
<span class="line"> 18</span>  * All portions of the code are Copyright (C) 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014 Zimbra, Inc. All Rights Reserved. 
<span class="line"> 19</span>  * ***** END LICENSE BLOCK *****
<span class="line"> 20</span>  */</span><span class="WHIT">
<span class="line"> 21</span> 
<span class="line"> 22</span> </span><span class="COMM">/**
<span class="line"> 23</span>  * @overview
<span class="line"> 24</span>  */</span><span class="WHIT">
<span class="line"> 25</span> 
<span class="line"> 26</span> </span><span class="COMM">/**
<span class="line"> 27</span>  * Creates a dialog with various trees so a user can select a folder.
<span class="line"> 28</span>  * @class
<span class="line"> 29</span>  * This class represents choose folder dialog.
<span class="line"> 30</span>  * 
<span class="line"> 31</span>  * @param	{DwtControl}	shell		the parent
<span class="line"> 32</span>  * @param	{String}	className		the class name
<span class="line"> 33</span>  * 
<span class="line"> 34</span>  * @extends		ZmDialog
<span class="line"> 35</span>  */</span><span class="WHIT">
<span class="line"> 36</span> </span><span class="NAME">ZmChooseFolderDialog</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">className</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line"> 37</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newButton</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DwtDialog_ButtonDescriptor</span><span class="PUNC">(</span><span class="NAME">ZmChooseFolderDialog.NEW_BUTTON</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ZmMsg._new</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DwtDialog.ALIGN_LEFT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 38</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">parent</span><span class="PUNC">:</span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">className</span><span class="PUNC">:</span><span class="NAME">className</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">extraButtons</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NAME">newButton</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">:</span><span class="STRN">&#34;ChooseFolderDialog&#34;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 39</span> </span><span class="WHIT">	</span><span class="NAME">ZmDialog.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 40</span> 
<span class="line"> 41</span> </span><span class="WHIT">	</span><span class="NAME">this._createControls</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 42</span> </span><span class="WHIT">	</span><span class="NAME">this._setNameField</span><span class="PUNC">(</span><span class="NAME">this._inputDivId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 43</span> </span><span class="WHIT">	</span><span class="NAME">this.registerCallback</span><span class="PUNC">(</span><span class="NAME">ZmChooseFolderDialog.NEW_BUTTON</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._showNewDialog</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 44</span> </span><span class="WHIT">	</span><span class="NAME">this._changeListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AjxListener</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._folderTreeChangeListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 45</span> 
<span class="line"> 46</span> </span><span class="WHIT">	</span><span class="NAME">this._treeView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 47</span> </span><span class="WHIT">	</span><span class="NAME">this._creatingFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 48</span> </span><span class="WHIT">	</span><span class="NAME">this._treeViewListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AjxListener</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._treeViewSelectionListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 49</span> 
<span class="line"> 50</span> </span><span class="WHIT">	</span><span class="NAME">this._multiAcctOverviews</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 51</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 52</span> 
<span class="line"> 53</span> </span><span class="NAME">ZmChooseFolderDialog.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ZmDialog</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 54</span> </span><span class="NAME">ZmChooseFolderDialog.prototype.constructor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmChooseFolderDialog</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 55</span> 
<span class="line"> 56</span> </span><span class="NAME">ZmChooseFolderDialog.prototype.isZmChooseFolderDialog</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 57</span> </span><span class="NAME">ZmChooseFolderDialog.prototype.toString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">&#34;ZmChooseFolderDialog&#34;</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 58</span> 
<span class="line"> 59</span> </span><span class="NAME">ZmChooseFolderDialog.NEW_BUTTON</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">DwtDialog.LAST_BUTTON</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 60</span> 
<span class="line"> 61</span> 
<span class="line"> 62</span> </span><span class="COMM">/**
<span class="line"> 63</span>  * Since this dialog is intended for use in a variety of situations, we need to be
<span class="line"> 64</span>  * able to create different sorts of overviews based on what the calling function
<span class="line"> 65</span>  * wants. By default, we show the folder tree view.
<span class="line"> 66</span>  * 
<span class="line"> 67</span>  * @param {Hash}	params				a hash of parameters
<span class="line"> 68</span>  * @param	{Object}	params.data					a array of items, a folder, an item or &lt;code&gt;null&lt;/code&gt;
<span class="line"> 69</span>  * @param	{Array}	params.treeIds				a list of trees to show
<span class="line"> 70</span>  * @param	{String}	params.overviewId			the overview ID
<span class="line"> 71</span>  * @param	{Hash}	params.omit					a list IDs to not show
<span class="line"> 72</span>  * @param	{String}	params.title					the dialog title
<span class="line"> 73</span>  * @param	{String}	params.description			the description of what the user is selecting
<span class="line"> 74</span>  * @param	{Boolean}	params.skipReadOnly		if &lt;code&gt;true&lt;/code&gt;, read-only folders will not be displayed
<span class="line"> 75</span>  * @param	{Boolean}	params.skipRemote			if &lt;code&gt;true&lt;/code&gt;, remote folders (mountpoints) will not be displayed
<span class="line"> 76</span>  * @param	{Boolean}	params.hideNewButton 		if &lt;code&gt;true&lt;/code&gt;, new button will not be shown
<span class="line"> 77</span>  * @param	{Boolean}	params.noRootSelect			if &lt;code&gt;true&lt;/code&gt;, do not make root tree item(s) selectable
<span class="line"> 78</span>  * @params  {Boolean}   params.showDrafts			if &lt;code&gt;true&lt;/code&gt;, drafts folder will not be omited
<span class="line"> 79</span>  */</span><span class="WHIT">
<span class="line"> 80</span> </span><span class="NAME">ZmChooseFolderDialog.prototype.popup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line"> 81</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line"> 82</span> 
<span class="line"> 83</span> </span><span class="WHIT">	</span><span class="NAME">this._keyPressedInField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//see comment in _handleKeyUp</span><span class="WHIT">
<span class="line"> 84</span> 
<span class="line"> 85</span> </span><span class="WHIT">	</span><span class="COMM">// use reasonable defaults</span><span class="WHIT">
<span class="line"> 86</span> </span><span class="WHIT">	</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 87</span> 
<span class="line"> 88</span> </span><span class="WHIT">	</span><span class="COMM">// create an omit list for each account</span><span class="WHIT">
<span class="line"> 89</span> </span><span class="WHIT">	</span><span class="COMM">// XXX: does this need to happen more then once???</span><span class="WHIT">
<span class="line"> 90</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">omitPerAcct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 91</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">accounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">appCtxt.accountList.visibleAccounts</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 92</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">accounts.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line"> 93</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">acct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">accounts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 94</span> 
<span class="line"> 95</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.forceSingle</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">acct</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">appCtxt.getActiveAccount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line"> 96</span> </span><span class="WHIT">			</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 97</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line"> 98</span> 
<span class="line"> 99</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">omit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">omitPerAcct</span><span class="PUNC">[</span><span class="NAME">acct.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.omit</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">100</span> </span><span class="WHIT">		
<span class="line">101</span> 		</span><span class="NAME">omit</span><span class="PUNC">[</span><span class="NAME">ZmFolder.ID_DRAFTS</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">params.showDrafts</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">102</span> </span><span class="WHIT">		</span><span class="NAME">omit</span><span class="PUNC">[</span><span class="NAME">ZmFolder.ID_OUTBOX</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">103</span> </span><span class="WHIT">		</span><span class="NAME">omit</span><span class="PUNC">[</span><span class="NAME">ZmFolder.ID_SYNC_FAILURES</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">104</span> </span><span class="WHIT">		</span><span class="NAME">omit</span><span class="PUNC">[</span><span class="NAME">ZmFolder.ID_DLS</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">105</span> 
<span class="line">106</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">folderTree</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">appCtxt.getFolderTree</span><span class="PUNC">(</span><span class="NAME">acct</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">107</span> 
<span class="line">108</span> </span><span class="WHIT">		</span><span class="COMM">// omit any folders that are read only</span><span class="WHIT">
<span class="line">109</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.skipReadOnly</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.skipRemote</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">appCtxt.isOffline</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">110</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">folders</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">folderTree.asList</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">includeRemote</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">111</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">folders.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">112</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">folder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">folders</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">113</span> 
<span class="line">114</span> </span><span class="WHIT">				</span><span class="COMM">// if skipping read-only,</span><span class="WHIT">
<span class="line">115</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.skipReadOnly</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">folder.link</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">folder.isReadOnly</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">116</span> </span><span class="WHIT">					</span><span class="NAME">omit</span><span class="PUNC">[</span><span class="NAME">folder.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">117</span> </span><span class="WHIT">					</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">118</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">119</span> 
<span class="line">120</span> </span><span class="WHIT">				</span><span class="COMM">// if skipping remote folders,</span><span class="WHIT">
<span class="line">121</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.skipRemote</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">folder.isRemote</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">122</span> </span><span class="WHIT">					</span><span class="NAME">omit</span><span class="PUNC">[</span><span class="NAME">folders</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">123</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">124</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">125</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">126</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">127</span> 
<span class="line">128</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.setTitle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">129</span> </span><span class="WHIT">		</span><span class="NAME">this.setTitle</span><span class="PUNC">(</span><span class="NAME">params.title</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ZmMsg.chooseFolder</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">130</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">131</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">descCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">this._folderDescDivId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">132</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">descCell</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">133</span> </span><span class="WHIT">		</span><span class="NAME">descCell.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.description</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">&#34;&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">134</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">135</span> 
<span class="line">136</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">treeIds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._treeIds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.treeIds</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">params.treeIds.length</span><span class="PUNC">)</span><span class="WHIT">
<span class="line">137</span> </span><span class="WHIT">		</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">params.treeIds</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">ZmOrganizer.FOLDER</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">138</span> 
<span class="line">139</span> </span><span class="WHIT">	</span><span class="COMM">// New button doesn&#39;t make sense if we&#39;re only showing saved searches</span><span class="WHIT">
<span class="line">140</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">searchOnly</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">treeIds.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">treeIds</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ZmOrganizer.SEARCH</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">141</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newButton</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getNewButton</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">142</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newButton</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">143</span> </span><span class="WHIT">		</span><span class="NAME">newButton.setVisible</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">searchOnly</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">params.hideNewButton</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">appCtxt.isExternalAccount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">appCtxt.isWebClientOffline</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">144</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">145</span> 
<span class="line">146</span> </span><span class="WHIT">	</span><span class="NAME">this._data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.data</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">147</span> 
<span class="line">148</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">omitParam</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">149</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">appCtxt.multiAccounts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">150</span> </span><span class="WHIT">		</span><span class="NAME">omitParam</span><span class="PUNC">[</span><span class="NAME">ZmOrganizer.ID_ZIMLET</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">151</span> </span><span class="WHIT">		</span><span class="NAME">omitParam</span><span class="PUNC">[</span><span class="NAME">ZmOrganizer.ID_ALL_MAILBOXES</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">152</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">153</span> </span><span class="WHIT">		</span><span class="NAME">omitParam</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">omitPerAcct</span><span class="PUNC">[</span><span class="NAME">appCtxt.accountList.mainAccount.id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">154</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">155</span> </span><span class="WHIT">	
<span class="line">156</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">popupParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">157</span> </span><span class="WHIT">		</span><span class="NAME">treeIds</span><span class="PUNC">:</span><span class="WHIT">		</span><span class="NAME">treeIds</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">158</span> </span><span class="WHIT">		</span><span class="NAME">omit</span><span class="PUNC">:</span><span class="WHIT">			</span><span class="NAME">omitParam</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">159</span> </span><span class="WHIT">		</span><span class="NAME">omitPerAcct</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">omitPerAcct</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">160</span> </span><span class="WHIT">		</span><span class="NAME">fieldId</span><span class="PUNC">:</span><span class="WHIT">		</span><span class="NAME">this._folderTreeDivId</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">161</span> </span><span class="WHIT">		</span><span class="NAME">overviewId</span><span class="PUNC">:</span><span class="WHIT">		</span><span class="NAME">params.overviewId</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">162</span> </span><span class="WHIT">		</span><span class="NAME">noRootSelect</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">params.noRootSelect</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">163</span> </span><span class="WHIT">		</span><span class="NAME">treeStyle</span><span class="PUNC">:</span><span class="WHIT">		</span><span class="NAME">params.treeStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">DwtTree.SINGLE_STYLE</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="COMM">// we don&#39;t want checkboxes!</span><span class="WHIT">
<span class="line">164</span> </span><span class="WHIT">		</span><span class="NAME">appName</span><span class="PUNC">:</span><span class="WHIT">		</span><span class="NAME">params.appName</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">165</span> </span><span class="WHIT">		</span><span class="NAME">selectable</span><span class="PUNC">:</span><span class="WHIT">		</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">166</span> </span><span class="WHIT">		</span><span class="NAME">forceSingle</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">params.forceSingle</span><span class="WHIT">
<span class="line">167</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">168</span> 
<span class="line">169</span> </span><span class="WHIT">	</span><span class="COMM">// make sure the requisite packages are loaded</span><span class="WHIT">
<span class="line">170</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">treeIdMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">171</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">treeIds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">172</span> </span><span class="WHIT">		</span><span class="NAME">treeIdMap</span><span class="PUNC">[</span><span class="NAME">treeIds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">173</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">174</span> 
<span class="line">175</span> </span><span class="WHIT">	</span><span class="NAME">this._acceptFolderMatch</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.acceptFolderMatch</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">176</span> 
<span class="line">177</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: Refactor packages so that we don&#39;t have to bring in so much</span><span class="WHIT">
<span class="line">178</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: code just do make sure this dialog works.</span><span class="WHIT">
<span class="line">179</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: I opened bug 34447 for this performance enhancement.</span><span class="WHIT">
<span class="line">180</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pkg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">181</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">treeIdMap</span><span class="PUNC">[</span><span class="NAME">ZmOrganizer.BRIEFCASE</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">pkg.push</span><span class="PUNC">(</span><span class="STRN">&#34;BriefcaseCore&#34;</span><span class="PUNC">,</span><span class="STRN">&#34;Briefcase&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">182</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">treeIdMap</span><span class="PUNC">[</span><span class="NAME">ZmOrganizer.CALENDAR</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">pkg.push</span><span class="PUNC">(</span><span class="STRN">&#34;MailCore&#34;</span><span class="PUNC">,</span><span class="STRN">&#34;CalendarCore&#34;</span><span class="PUNC">,</span><span class="STRN">&#34;Calendar&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">183</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">treeIdMap</span><span class="PUNC">[</span><span class="NAME">ZmOrganizer.ADDRBOOK</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">pkg.push</span><span class="PUNC">(</span><span class="STRN">&#34;ContactsCore&#34;</span><span class="PUNC">,</span><span class="STRN">&#34;Contacts&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">184</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">treeIdMap</span><span class="PUNC">[</span><span class="NAME">ZmOrganizer.FOLDER</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">pkg.push</span><span class="PUNC">(</span><span class="STRN">&#34;MailCore&#34;</span><span class="PUNC">,</span><span class="STRN">&#34;Mail&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">185</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">treeIdMap</span><span class="PUNC">[</span><span class="NAME">ZmOrganizer.TASKS</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">pkg.push</span><span class="PUNC">(</span><span class="STRN">&#34;TasksCore&#34;</span><span class="PUNC">,</span><span class="STRN">&#34;Tasks&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">186</span> </span><span class="WHIT">	
<span class="line">187</span> 	</span><span class="NAME">AjxDispatcher.require</span><span class="PUNC">(</span><span class="NAME">pkg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AjxCallback</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._doPopup</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">popupParams</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">188</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">189</span> 
<span class="line">190</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._getNewButton</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">191</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">192</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getButton</span><span class="PUNC">(</span><span class="NAME">ZmChooseFolderDialog.NEW_BUTTON</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">193</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">194</span> 
<span class="line">195</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._doPopup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">196</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">197</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ov</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._setOverview</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.forceSingle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">198</span> 
<span class="line">199</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">appCtxt.multiAccounts</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">params.forceSingle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">200</span> </span><span class="WHIT">		</span><span class="COMM">// ov is an overview container, and overviewId is the containerId</span><span class="WHIT">
<span class="line">201</span> </span><span class="WHIT">		</span><span class="NAME">this._multiAcctOverviews</span><span class="PUNC">[</span><span class="NAME">params.overviewId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ov</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">202</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._multiAcctOverviews</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">203</span> </span><span class="WHIT">			</span><span class="NAME">this._multiAcctOverviews</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setVisible</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">params.overviewId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">204</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">205</span> 
<span class="line">206</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">overviews</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ov.getOverviews</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">207</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">overviews</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">208</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">overview</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">overviews</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">209</span> </span><span class="WHIT">            </span><span class="COMM">// zimlet overview resets folder list</span><span class="WHIT">
<span class="line">210</span> </span><span class="WHIT">            </span><span class="COMM">// need to stop resetting folder list for each overview</span><span class="WHIT">
<span class="line">211</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">overview._treeIds</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">&#34;zimlet&#34;</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">212</span> </span><span class="WHIT">                </span><span class="NAME">this._resetTree</span><span class="PUNC">(</span><span class="NAME">params.treeIds</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overview</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">213</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">214</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">215</span> 
<span class="line">216</span> </span><span class="WHIT">		</span><span class="NAME">ov.expandAccountOnly</span><span class="PUNC">(</span><span class="NAME">appCtxt.getActiveAccount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">217</span> 
<span class="line">218</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">219</span> </span><span class="WHIT">		</span><span class="NAME">this._resetTree</span><span class="PUNC">(</span><span class="NAME">params.treeIds</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ov</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">220</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">221</span> 
<span class="line">222</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isZmDialog</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">223</span> </span><span class="WHIT">		</span><span class="NAME">this._focusElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._inputField</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">224</span> </span><span class="WHIT">		</span><span class="NAME">this._inputField.setValue</span><span class="PUNC">(</span><span class="STRN">&#34;&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">225</span> </span><span class="WHIT">		</span><span class="NAME">ZmDialog.prototype.popup.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">226</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">227</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">228</span> 
<span class="line">229</span> 
<span class="line">230</span> </span><span class="NAME">ZmChooseFolderDialog.prototype.getOverviewId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">231</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">part</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">appName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">232</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">appCtxt.getOverviewId</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">part</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">appName</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">233</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">234</span> 
<span class="line">235</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._resetTree</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">236</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">treeIds</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overview</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">237</span> 
<span class="line">238</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">account</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">overview.account</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">appCtxt.getActiveAccount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">appCtxt.accountList.mainAccount</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">239</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">acctTreeView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._treeView</span><span class="PUNC">[</span><span class="NAME">account.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">240</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">folderTree</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">appCtxt.getFolderTree</span><span class="PUNC">(</span><span class="NAME">account</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">241</span> 
<span class="line">242</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">treeIds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">243</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">treeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">treeIds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">244</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">treeView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">acctTreeView</span><span class="PUNC">[</span><span class="NAME">treeId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">overview.getTreeView</span><span class="PUNC">(</span><span class="NAME">treeId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">245</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">treeView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">246</span> 
<span class="line">247</span> </span><span class="WHIT">		</span><span class="COMM">// bug #18533 - always make sure header item is visible in &#34;MoveTo&#34; dialog</span><span class="WHIT">
<span class="line">248</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">headerItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">treeView.getHeaderItem</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">249</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">treeIds.length</span><span class="WHIT"> </span><span class="PUNC">&gt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">250</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">treeId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ZmId.ORG_FOLDER</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">251</span> </span><span class="WHIT">				</span><span class="NAME">headerItem.setText</span><span class="PUNC">(</span><span class="NAME">ZmMsg.mailFolders</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">252</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">253</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">treeId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ZmId.ORG_BRIEFCASE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">254</span> </span><span class="WHIT">				</span><span class="NAME">headerItem.setText</span><span class="PUNC">(</span><span class="NAME">ZmMsg.briefcaseFolders</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">255</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">256</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">257</span> </span><span class="WHIT">		</span><span class="NAME">headerItem.setVisible</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">258</span> 
<span class="line">259</span> </span><span class="WHIT">		</span><span class="COMM">// expand root item</span><span class="WHIT">
<span class="line">260</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ti</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">treeView.getTreeItemById</span><span class="PUNC">(</span><span class="NAME">folderTree.root.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">261</span> </span><span class="WHIT">		</span><span class="NAME">ti.setExpanded</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">262</span> 
<span class="line">263</span> </span><span class="WHIT">		</span><span class="COMM">// bug fix #13159 (regression of #10676)</span><span class="WHIT">
<span class="line">264</span> </span><span class="WHIT">		</span><span class="COMM">// - small hack to get selecting Trash folder working again</span><span class="WHIT">
<span class="line">265</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">trashId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmOrganizer.getSystemId</span><span class="PUNC">(</span><span class="NAME">ZmOrganizer.ID_TRASH</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">account</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">266</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ti</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">treeView.getTreeItemById</span><span class="PUNC">(</span><span class="NAME">trashId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">267</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ti</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">268</span> </span><span class="WHIT">			</span><span class="NAME">ti.setData</span><span class="PUNC">(</span><span class="NAME">ZmTreeView.KEY_TYPE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">treeId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">269</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">270</span> 
<span class="line">271</span> </span><span class="WHIT">		</span><span class="NAME">treeView.removeSelectionListener</span><span class="PUNC">(</span><span class="NAME">this._treeViewListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">272</span> </span><span class="WHIT">		</span><span class="NAME">treeView.addSelectionListener</span><span class="PUNC">(</span><span class="NAME">this._treeViewListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">273</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">274</span> 
<span class="line">275</span> </span><span class="WHIT">	</span><span class="NAME">folderTree.removeChangeListener</span><span class="PUNC">(</span><span class="NAME">this._changeListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">276</span> </span><span class="WHIT">	</span><span class="COMM">// this listener has to be added after folder tree view is set</span><span class="WHIT">
<span class="line">277</span> </span><span class="WHIT">	</span><span class="COMM">// (so that it comes after the view&#39;s standard change listener)</span><span class="WHIT">
<span class="line">278</span> </span><span class="WHIT">	</span><span class="NAME">folderTree.addChangeListener</span><span class="PUNC">(</span><span class="NAME">this._changeListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">279</span> 
<span class="line">280</span> </span><span class="WHIT">	</span><span class="NAME">this._loadFolders</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">281</span> </span><span class="WHIT">	</span><span class="NAME">this._resetTreeView</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">282</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">283</span> 
<span class="line">284</span> </span><span class="NAME">ZmChooseFolderDialog.prototype.reset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">285</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">286</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">descCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">this._folderDescDivId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">287</span> </span><span class="WHIT">	</span><span class="NAME">descCell.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">288</span> </span><span class="WHIT">	</span><span class="NAME">ZmDialog.prototype.reset.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">289</span> </span><span class="WHIT">	</span><span class="NAME">this._data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._treeIds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">290</span> </span><span class="WHIT">	</span><span class="NAME">this._creatingFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">291</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">292</span> 
<span class="line">293</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._contentHtml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">294</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">295</span> </span><span class="WHIT">	</span><span class="NAME">this._inputDivId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._htmlElId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;_inputDivId&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">296</span> </span><span class="WHIT">	</span><span class="NAME">this._folderDescDivId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._htmlElId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;_folderDescDivId&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">297</span> </span><span class="WHIT">	</span><span class="NAME">this._folderTreeDivId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._htmlElId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;_folderTreeDivId&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">298</span> 
<span class="line">299</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">AjxTemplate.expand</span><span class="PUNC">(</span><span class="STRN">&#34;share.Widgets#ZmChooseFolderDialog&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">this._htmlElId</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">300</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">301</span> 
<span class="line">302</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._createControls</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">303</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">304</span> </span><span class="WHIT">	</span><span class="NAME">this._inputField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DwtInputField</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">parent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">305</span> </span><span class="WHIT">	</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">this._inputDivId</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">appendChild</span><span class="PUNC">(</span><span class="NAME">this._inputField.getHtmlElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">306</span> </span><span class="WHIT">	</span><span class="NAME">this._inputField.addListener</span><span class="PUNC">(</span><span class="NAME">DwtEvent.ONKEYUP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AjxListener</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._handleKeyUp</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">307</span> </span><span class="WHIT">	</span><span class="COMM">//this._inputField.addListener(DwtEvent.ONKEYDOWN, new AjxListener(this, this._handleKeyDown));</span><span class="WHIT">
<span class="line">308</span> </span><span class="WHIT">	</span><span class="COMM">// unfortunately there&#39;s no onkeydown generally set for input fields so above line does not work</span><span class="WHIT">
<span class="line">309</span> </span><span class="WHIT">	</span><span class="NAME">this._inputField.setHandler</span><span class="PUNC">(</span><span class="NAME">DwtEvent.ONKEYDOWN</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">AjxCallback.simpleClosure</span><span class="PUNC">(</span><span class="NAME">this._handleKeyDown</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">310</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">311</span> 
<span class="line">312</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._showNewDialog</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">313</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">314</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getOverview</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getSelected</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">315</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._treeIds</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">316</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ftc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._opc.getTreeController</span><span class="PUNC">(</span><span class="NAME">newType</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">317</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dialog</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ftc._getNewDialog</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">318</span> </span><span class="WHIT">	</span><span class="NAME">dialog.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">319</span> </span><span class="WHIT">	</span><span class="NAME">dialog.registerCallback</span><span class="PUNC">(</span><span class="NAME">DwtDialog.OK_BUTTON</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._newCallback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">ftc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dialog</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">320</span> </span><span class="WHIT">	</span><span class="NAME">dialog.popup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">321</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">322</span> 
<span class="line">323</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._newCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">324</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ftc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dialog</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">325</span> </span><span class="WHIT">	</span><span class="NAME">ftc._doCreate</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">326</span> </span><span class="WHIT">	</span><span class="NAME">dialog.popdown</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">327</span> </span><span class="WHIT">	</span><span class="NAME">this._creatingFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">328</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">329</span> 
<span class="line">330</span> </span><span class="COMM">// After the user creates a folder, select it and optionally move items to it.</span><span class="WHIT">
<span class="line">331</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._folderTreeChangeListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">332</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">333</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.event</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ZmEvent.E_CREATE</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._creatingFolder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">334</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">organizers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ev.getDetail</span><span class="PUNC">(</span><span class="STRN">&#34;organizers&#34;</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.source</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">ev.source</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">335</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">org</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">organizers</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">336</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">org</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">337</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._treeView</span><span class="PUNC">[</span><span class="NAME">org.getAccount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">org.type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">338</span> </span><span class="WHIT">			</span><span class="NAME">tv.setSelected</span><span class="PUNC">(</span><span class="NAME">org</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">339</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._moveOnFolderCreate</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">ev.shiftKey</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">ev.ctrlKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">340</span> </span><span class="WHIT">				</span><span class="NAME">tv._itemClicked</span><span class="PUNC">(</span><span class="NAME">tv.getTreeItemById</span><span class="PUNC">(</span><span class="NAME">org.id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">341</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">342</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">343</span> </span><span class="WHIT">		</span><span class="NAME">this._creatingFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">344</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">345</span> </span><span class="WHIT">	</span><span class="NAME">this._loadFolders</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">346</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">347</span> 
<span class="line">348</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._okButtonListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">349</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">350</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tgtFolder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getOverview</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getSelected</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">351</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tgtType</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getOverview</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getSelected</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">352</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">folderList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tgtFolder</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">tgtFolder</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class="line">353</span> </span><span class="WHIT">		</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">tgtFolder</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tgtFolder</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">354</span> 
<span class="line">355</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">folderList</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">folderList</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">folderList.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class="line">356</span> </span><span class="WHIT">		</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">ZmMsg.noTargetFolder</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">357</span> 
<span class="line">358</span> </span><span class="WHIT">	</span><span class="COMM">// check for valid target</span><span class="WHIT">
<span class="line">359</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">360</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">folderList.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">361</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">folder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">folderList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">362</span> </span><span class="WHIT">			</span><span class="COMM">//Note - although this case is checked in mayContain, I do not change mayContain since mayContain is complicated and returns a boolean and used from DnD and is overridden a bunch of times.</span><span class="WHIT">
<span class="line">363</span> </span><span class="WHIT">			</span><span class="COMM">//Only here we need the special message (see bug 82064) so I settle for that for now.</span><span class="WHIT">
<span class="line">364</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._data.isZmFolder</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">folder.isInTrash</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">folder.hasChild</span><span class="PUNC">(</span><span class="NAME">this._data.name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this._acceptFolderMatch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">365</span> </span><span class="WHIT">				</span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmMsg.folderAlreadyExistsInDestination</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">366</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">367</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">368</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">folder.mayContain</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">folder.mayContain</span><span class="PUNC">(</span><span class="NAME">this._data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tgtType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._acceptFolderMatch</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">369</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._data.isZmFolder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">370</span> </span><span class="WHIT">					</span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmMsg.badTargetFolder</span><span class="PUNC">;</span><span class="WHIT"> 
<span class="line">371</span> 				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">372</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxUtil.toArray</span><span class="PUNC">(</span><span class="NAME">this._data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">373</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">374</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">375</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">376</span> </span><span class="WHIT">							</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">377</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">378</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item.isDraft</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">folder.nId</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">ZmFolder.ID_TRASH</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">folder.nId</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">ZmFolder.ID_DRAFTS</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">folder.rid</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">ZmFolder.ID_DRAFTS</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">379</span> </span><span class="WHIT">							</span><span class="COMM">// can move drafts into Trash or Drafts</span><span class="WHIT">
<span class="line">380</span> </span><span class="WHIT">							</span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmMsg.badTargetFolderForDraftItem</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">381</span> </span><span class="WHIT">							</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">382</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">folder.nId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ZmFolder.ID_DRAFTS</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">folder.rid</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ZmFolder.ID_DRAFTS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">item.isDraft</span><span class="PUNC">)</span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class="line">383</span> </span><span class="WHIT">							</span><span class="COMM">// only drafts can be moved into Drafts</span><span class="WHIT">
<span class="line">384</span> </span><span class="WHIT">							</span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmMsg.badItemForDraftsFolder</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">385</span> </span><span class="WHIT">							</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">386</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">387</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">	
<span class="line">388</span> 					</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">389</span> </span><span class="WHIT">						</span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmMsg.badTargetFolderItems</span><span class="PUNC">;</span><span class="WHIT"> 
<span class="line">390</span> 					</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">391</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">392</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">393</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">394</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">395</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">396</span> 
<span class="line">397</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">398</span> </span><span class="WHIT">		</span><span class="NAME">this._showError</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">399</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">400</span> </span><span class="WHIT">		</span><span class="NAME">DwtDialog.prototype._buttonListener.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">tgtFolder</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">401</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">402</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">403</span> 
<span class="line">404</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._getTabGroupMembers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">405</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">406</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">this._inputField</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._overview</span><span class="PUNC">[</span><span class="NAME">this._curOverviewId</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">407</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">408</span> 
<span class="line">409</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._loadFolders</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">410</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">411</span> </span><span class="WHIT">	</span><span class="NAME">this._folders</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">412</span> 
<span class="line">413</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">accountId</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._treeView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">414</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">treeViews</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._treeView</span><span class="PUNC">[</span><span class="NAME">accountId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">415</span> 
<span class="line">416</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">treeViews</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">417</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">treeView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">treeViews</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">418</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">treeView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">419</span> 
<span class="line">420</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">treeView.getTreeItemList</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">421</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">422</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ti</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">423</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ti.getData</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">  </span><span class="COMM">//not sure if this could happen but it was here before my refactoring.</span><span class="WHIT">
<span class="line">424</span> </span><span class="WHIT">					</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">425</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">426</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">folder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getData</span><span class="PUNC">(</span><span class="NAME">Dwt.KEY_OBJECT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">427</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">folder</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">folder.nId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ZmOrganizer.ID_ROOT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">428</span> </span><span class="WHIT">					</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">429</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">430</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">folder.getName</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">431</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;/&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">folder.getPath</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">432</span> </span><span class="WHIT">				</span><span class="NAME">this._folders.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">folder.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">accountId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">accountId</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">433</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">434</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">435</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">436</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">437</span> 
<span class="line">438</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._handleKeyDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">439</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">440</span> </span><span class="WHIT">	</span><span class="NAME">this._keyPressedInField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//see comment in _handleKeyUp</span><span class="WHIT">
<span class="line">441</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">442</span> 
<span class="line">443</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._handleKeyUp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">444</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">445</span> 
<span class="line">446</span> </span><span class="WHIT">	</span><span class="COMM">// this happens in the case of SearchFolder when the keyboard shortcut &#34;s&#34; was released when this</span><span class="WHIT">
<span class="line">447</span> </span><span class="WHIT">	</span><span class="COMM">// field was in focus but it does not affect the field since it was not pressed here.</span><span class="WHIT">
<span class="line">448</span> </span><span class="WHIT">	</span><span class="COMM">// (Bug 52983)</span><span class="WHIT">
<span class="line">449</span> </span><span class="WHIT">	</span><span class="COMM">// in other words, the sequence that caused the bug is:</span><span class="WHIT">
<span class="line">450</span> </span><span class="WHIT">	</span><span class="COMM">// 1. &#34;s&#34; keyDown triggering ZmDialog.prototype.popup()</span><span class="WHIT">
<span class="line">451</span> </span><span class="WHIT">	</span><span class="COMM">// 2. ZmDialog.prototype.popup setting focus on the input field</span><span class="WHIT">
<span class="line">452</span> </span><span class="WHIT">	</span><span class="COMM">// 3. &#34;s&#34; keyUp called triggering ZmChooseFolderDialog.prototype._handleKeyUp.</span><span class="WHIT">
<span class="line">453</span> </span><span class="WHIT">	</span><span class="COMM">// Note that this is reset to false in the popup only, since only one time we need this protection, and it&#39;s the simplest.</span><span class="WHIT">
<span class="line">454</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._keyPressedInField</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">455</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">456</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">457</span> 
<span class="line">458</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtKeyEvent.getCharCode</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">459</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">460</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">461</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">40</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">462</span> </span><span class="WHIT">		</span><span class="NAME">this._overview</span><span class="PUNC">[</span><span class="NAME">this._curOverviewId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">463</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">464</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">465</span> 
<span class="line">466</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">num</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">firstMatch</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">matches</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">467</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._inputField.getValue</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">468</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._folders.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">469</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">folderInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._folders</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">470</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">treeView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._treeView</span><span class="PUNC">[</span><span class="NAME">folderInfo.accountId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">folderInfo.type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">471</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ti</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">treeView.getTreeItemById</span><span class="PUNC">(</span><span class="NAME">folderInfo.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">472</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ti</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">473</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">testPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;/&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">value.replace</span><span class="PUNC">(</span><span class="REGX">/^\//</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">474</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">folderInfo.path</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">475</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">folderInfo.name.indexOf</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class="line">476</span> </span><span class="WHIT">				</span><span class="PUNC">(</span><span class="NAME">path.indexOf</span><span class="PUNC">(</span><span class="NAME">testPath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path.substr</span><span class="PUNC">(</span><span class="NAME">testPath.length</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">&#34;/&#34;</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">477</span> 
<span class="line">478</span> </span><span class="WHIT">				</span><span class="NAME">matches.push</span><span class="PUNC">(</span><span class="NAME">ti</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">479</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">activeAccountId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">appCtxt.getActiveAccount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">480</span> </span><span class="WHIT">				</span><span class="COMM">//choose the FIRST of active account folders. </span><span class="WHIT">
<span class="line">481</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">firstMatch</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">folderInfo.accountId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">activeAccountId</span><span class="WHIT">
<span class="line">482</span> </span><span class="WHIT">								</span><span class="PUNC">&amp;&amp;</span><span class="WHIT">	</span><span class="NAME">firstMatch.accountId</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">activeAccountId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">483</span> </span><span class="WHIT">                    </span><span class="NAME">firstMatch</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">folderInfo</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">484</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">485</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">486</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">487</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">488</span> 
<span class="line">489</span> </span><span class="WHIT">	</span><span class="COMM">// now that we know which folders match, hide all items and then show</span><span class="WHIT">
<span class="line">490</span> </span><span class="WHIT">	</span><span class="COMM">// the matches, expanding their parent chains as needed</span><span class="WHIT">
<span class="line">491</span> </span><span class="WHIT">	</span><span class="NAME">this._resetTreeView</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">492</span> 
<span class="line">493</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">matches.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">494</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ti</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">matches</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">495</span> </span><span class="WHIT">		</span><span class="NAME">ti._tree._expandUp</span><span class="PUNC">(</span><span class="NAME">ti</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">496</span> </span><span class="WHIT">		</span><span class="NAME">ti.setVisible</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">497</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">498</span> 
<span class="line">499</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">firstMatch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">500</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._treeView</span><span class="PUNC">[</span><span class="NAME">firstMatch.accountId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">firstMatch.type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">501</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ov</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getOverview</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">502</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ov</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">503</span> </span><span class="WHIT">			</span><span class="NAME">ov.deselectAllTreeViews</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">504</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">505</span> </span><span class="WHIT">		</span><span class="NAME">tv.setSelected</span><span class="PUNC">(</span><span class="NAME">appCtxt.getById</span><span class="PUNC">(</span><span class="NAME">firstMatch.id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">506</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">appCtxt.multiAccounts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">507</span> </span><span class="WHIT">		    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ov</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getOverview</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">508</span> </span><span class="WHIT">		    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">ov._headerItems</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">509</span> </span><span class="WHIT">			</span><span class="NAME">ov._headerItems</span><span class="PUNC">[</span><span class="NAME">h</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setExpanded</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">firstMatch.accountId</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">510</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">511</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">512</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">513</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">514</span> 
<span class="line">515</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._resetTreeView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">516</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">visible</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">517</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._folders.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">518</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">folderInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._folders</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">519</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._treeView</span><span class="PUNC">[</span><span class="NAME">folderInfo.accountId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">folderInfo.type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">520</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ti</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tv.getTreeItemById</span><span class="PUNC">(</span><span class="NAME">folderInfo.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">521</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ti</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">522</span> </span><span class="WHIT">			</span><span class="NAME">ti.setVisible</span><span class="PUNC">(</span><span class="NAME">visible</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">523</span> </span><span class="WHIT">			</span><span class="NAME">ti.setChecked</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">524</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">525</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">526</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">527</span> 
<span class="line">528</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._getOverview</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">529</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">530</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ov</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">531</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">appCtxt.multiAccounts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">532</span> </span><span class="WHIT">		</span><span class="NAME">ov</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._opc.getOverviewContainer</span><span class="PUNC">(</span><span class="NAME">this._curOverviewId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">533</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">534</span> 
<span class="line">535</span> </span><span class="WHIT">	</span><span class="COMM">// this covers the case where we&#39;re in multi-account mode, but dialog was</span><span class="WHIT">
<span class="line">536</span> </span><span class="WHIT">	</span><span class="COMM">// popped up in &#34;forceSingle&#34; mode</span><span class="WHIT">
<span class="line">537</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ov</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ZmDialog.prototype._getOverview.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">538</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">539</span> 
<span class="line">540</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._treeViewSelectionListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">541</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">542</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.detail</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">DwtTree.ITEM_SELECTED</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT">
<span class="line">543</span> </span><span class="WHIT">		</span><span class="NAME">ev.detail</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">DwtTree.ITEM_DBL_CLICKED</span><span class="PUNC">)</span><span class="WHIT">
<span class="line">544</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class="line">545</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">546</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">547</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">treeItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ev.item</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">548</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">treeItem</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">treeItem.isSelectionEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">549</span> </span><span class="WHIT">		</span><span class="COMM">// Selection should have been blocked, but only allow a double click if the item can be selected</span><span class="WHIT">
<span class="line">550</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">551</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">552</span> 
<span class="line">553</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._getOverview</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">ZmAccountOverviewContainer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">554</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.detail</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtTree.ITEM_DBL_CLICKED</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT">
<span class="line">555</span> </span><span class="WHIT">			</span><span class="NAME">ev.item</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">DwtHeaderTreeItem</span><span class="PUNC">)</span><span class="WHIT">
<span class="line">556</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class="line">557</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">558</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">559</span> 
<span class="line">560</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._opc.getOverviewContainer</span><span class="PUNC">(</span><span class="NAME">this._curOverviewId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">561</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">overview</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oc.getOverview</span><span class="PUNC">(</span><span class="NAME">ev.item.getData</span><span class="PUNC">(</span><span class="NAME">ZmTreeView.KEY_ID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">562</span> </span><span class="WHIT">		</span><span class="NAME">oc.deselectAll</span><span class="PUNC">(</span><span class="NAME">overview</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">563</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">564</span> 
<span class="line">565</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">organizer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ev.item</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">ev.item.getData</span><span class="PUNC">(</span><span class="NAME">Dwt.KEY_OBJECT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">566</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">organizer.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ZmFolder.ID_LOAD_FOLDERS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">567</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">568</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">569</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">organizer</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">organizer.getName</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ev.item.getText</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">570</span> </span><span class="WHIT">	</span><span class="NAME">this._inputField.setValue</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">571</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.detail</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtTree.ITEM_DBL_CLICKED</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ev.enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">572</span> </span><span class="WHIT">		</span><span class="NAME">this._okButtonListener</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">573</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">574</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">575</span> 
<span class="line">576</span> </span><span class="NAME">ZmChooseFolderDialog.prototype._enterListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">577</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">578</span> </span><span class="WHIT">	</span><span class="NAME">this._okButtonListener.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">579</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">580</span> </span></pre></body></html>
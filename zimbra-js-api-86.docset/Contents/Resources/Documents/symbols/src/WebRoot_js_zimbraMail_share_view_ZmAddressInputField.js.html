<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class="line">  1</span> <span class="COMM">/*
<span class="line">  2</span>  * ***** BEGIN LICENSE BLOCK *****
<span class="line">  3</span>  * Zimbra Collaboration Suite Web Client
<span class="line">  4</span>  * Copyright (C) 2010, 2011, 2012, 2013, 2014 Zimbra, Inc.
<span class="line">  5</span>  * 
<span class="line">  6</span>  * The contents of this file are subject to the Common Public Attribution License Version 1.0 (the &#34;License&#34;);
<span class="line">  7</span>  * you may not use this file except in compliance with the License. 
<span class="line">  8</span>  * You may obtain a copy of the License at: http://www.zimbra.com/license
<span class="line">  9</span>  * The License is based on the Mozilla Public License Version 1.1 but Sections 14 and 15 
<span class="line"> 10</span>  * have been added to cover use of software over a computer network and provide for limited attribution 
<span class="line"> 11</span>  * for the Original Developer. In addition, Exhibit A has been modified to be consistent with Exhibit B. 
<span class="line"> 12</span>  * 
<span class="line"> 13</span>  * Software distributed under the License is distributed on an &#34;AS IS&#34; basis, 
<span class="line"> 14</span>  * WITHOUT WARRANTY OF ANY KIND, either express or implied. 
<span class="line"> 15</span>  * See the License for the specific language governing rights and limitations under the License. 
<span class="line"> 16</span>  * The Original Code is Zimbra Open Source Web Client. 
<span class="line"> 17</span>  * The Initial Developer of the Original Code is Zimbra, Inc. 
<span class="line"> 18</span>  * All portions of the code are Copyright (C) 2010, 2011, 2012, 2013, 2014 Zimbra, Inc. All Rights Reserved. 
<span class="line"> 19</span>  * ***** END LICENSE BLOCK *****
<span class="line"> 20</span>  */</span><span class="WHIT">
<span class="line"> 21</span> 
<span class="line"> 22</span> </span><span class="COMM">/**
<span class="line"> 23</span>  * Creates an address input field that shows addresses as bubbles.
<span class="line"> 24</span>  * @constructor
<span class="line"> 25</span>  * @class
<span class="line"> 26</span>  * This class creates and manages a control for entering email addresses and displaying
<span class="line"> 27</span>  * them in bubbles. An address&#39;s surrounding bubble can be used to remove it, or, if the
<span class="line"> 28</span>  * address is a distribution list, expand it. They can be dragged to other address fields,
<span class="line"> 29</span>  * or reordered within this one. They can be selected via a &#34;rubber band&#34; selection box.
<span class="line"> 30</span>  * The bubbles support a few shortcuts.
<span class="line"> 31</span>  *
<span class="line"> 32</span>  * It is not a DwtInputField. If you don&#39;t want bubbles, use that (or a native INPUT) instead.
<span class="line"> 33</span>  *
<span class="line"> 34</span>  * @author Conrad Damon
<span class="line"> 35</span>  *
<span class="line"> 36</span>  * @param {hash}					params						hash of params:
<span class="line"> 37</span>  * @param {ZmAutocompleteListView}	autocompleteListView		associated autocomplete control
<span class="line"> 38</span>  * @param {string}      			inputId						an explicit ID to use for the control&#39;s INPUT element
<span class="line"> 39</span>  * @param {string}					templateId					custom template to use
<span class="line"> 40</span>  * @param {string}					type						arbitrary type to uniquely identify this among others
<span class="line"> 41</span>  * @param {boolean}					strictMode					if true (default), bubbles must contain valid addresses
<span class="line"> 42</span>  * @param {AjxCallback|function}	bubbleAddedCallback			called when a bubble is added
<span class="line"> 43</span>  * @param {AjxCallback|function}	bubbleRemovedCallback		called when a bubble is removed
<span class="line"> 44</span>  * @param {AjxCallback|function}	bubbleMenuCreatedCallback	called when the action menu has been created
<span class="line"> 45</span>  * @param {AjxCallback|function}	bubbleMenuResetOperationsCallback	called when the action menu has reset its operations
<span class="line"> 46</span>  * @param {boolean}					noOutsideListening			don&#39;t worry about outside mouse clicks
<span class="line"> 47</span>  */</span><span class="WHIT">
<span class="line"> 48</span> </span><span class="NAME">ZmAddressInputField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line"> 49</span> 
<span class="line"> 50</span> </span><span class="WHIT">	</span><span class="NAME">params.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.parent</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">appCtxt.getShell</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 51</span> </span><span class="WHIT">	</span><span class="NAME">params.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.className</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">&#34;addrBubbleContainer&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 52</span> </span><span class="WHIT">	</span><span class="NAME">DwtComposite.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 53</span> 
<span class="line"> 54</span> </span><span class="WHIT">	</span><span class="NAME">this._initialize</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 55</span> 
<span class="line"> 56</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.autocompleteListView</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line"> 57</span> </span><span class="WHIT">		</span><span class="NAME">this.setAutocompleteListView</span><span class="PUNC">(</span><span class="NAME">params.autocompleteListView</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 58</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line"> 59</span> 
<span class="line"> 60</span> </span><span class="WHIT">	</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.type</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 61</span> </span><span class="WHIT">	</span><span class="NAME">this._strictMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.strictMode</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 62</span> </span><span class="WHIT">	</span><span class="NAME">this._noOutsideListening</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.noOutsideListening</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 63</span> </span><span class="WHIT">	</span><span class="NAME">this._singleBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.singleBubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 64</span> 
<span class="line"> 65</span> </span><span class="WHIT">    </span><span class="NAME">this._bubbleAddedCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.bubbleAddedCallback</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 66</span> </span><span class="WHIT">    </span><span class="NAME">this._bubbleRemovedCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.bubbleRemovedCallback</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 67</span> </span><span class="WHIT">    </span><span class="NAME">this._bubbleMenuCreatedCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.bubbleMenuCreatedCallback</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 68</span> </span><span class="WHIT">    </span><span class="NAME">this._bubbleResetOperationsCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.bubbleMenuResetOperationsCallback</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 69</span> 
<span class="line"> 70</span> </span><span class="WHIT">	</span><span class="NAME">this._bubbleClassName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;addrBubble&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 71</span> 
<span class="line"> 72</span> </span><span class="WHIT">	</span><span class="NAME">this._bubbleList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ZmAddressBubbleList</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">parent</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">separator</span><span class="PUNC">:</span><span class="NAME">this._separator</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 73</span> </span><span class="WHIT">	</span><span class="NAME">this._bubbleList.addSelectionListener</span><span class="PUNC">(</span><span class="NAME">this._selectionListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 74</span> </span><span class="WHIT">	</span><span class="NAME">this._bubbleList.addActionListener</span><span class="PUNC">(</span><span class="NAME">this._actionListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 75</span> 
<span class="line"> 76</span> </span><span class="WHIT">	</span><span class="NAME">this._listeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 77</span> </span><span class="WHIT">	</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">ZmOperation.DELETE</span><span class="PUNC">]</span><span class="WHIT">		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._deleteListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 78</span> </span><span class="WHIT">	</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">ZmOperation.EDIT</span><span class="PUNC">]</span><span class="WHIT">		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._editListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 79</span> </span><span class="WHIT">	</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">ZmOperation.EXPAND</span><span class="PUNC">]</span><span class="WHIT">		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._expandListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 80</span> </span><span class="WHIT">	</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">ZmOperation.CONTACT</span><span class="PUNC">]</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._contactListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 81</span> 
<span class="line"> 82</span> </span><span class="WHIT">	</span><span class="COMM">// drag-and-drop of bubbles</span><span class="WHIT">
<span class="line"> 83</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropTgt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DwtDropTarget</span><span class="PUNC">(</span><span class="STRN">&#34;ZmAddressBubble&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 84</span> </span><span class="WHIT">	</span><span class="NAME">dropTgt.markAsMultiple</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 85</span> </span><span class="WHIT">	</span><span class="NAME">dropTgt.addDropListener</span><span class="PUNC">(</span><span class="NAME">this._dropListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 86</span> </span><span class="WHIT">	</span><span class="NAME">this.setDropTarget</span><span class="PUNC">(</span><span class="NAME">dropTgt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 87</span> 
<span class="line"> 88</span> </span><span class="WHIT">	</span><span class="COMM">// rubber-band selection of bubbles</span><span class="WHIT">
<span class="line"> 89</span> </span><span class="WHIT">	</span><span class="NAME">this._setEventHdlrs</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">DwtEvent.ONMOUSEDOWN</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONMOUSEMOVE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONMOUSEUP</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 90</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dragBox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DwtDragBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 91</span> </span><span class="WHIT">	</span><span class="NAME">dragBox.addDragListener</span><span class="PUNC">(</span><span class="NAME">this._dragBoxListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 92</span> </span><span class="WHIT">	</span><span class="NAME">this.setDragBox</span><span class="PUNC">(</span><span class="NAME">dragBox</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 93</span> 
<span class="line"> 94</span> </span><span class="WHIT">    </span><span class="NAME">this.addListener</span><span class="PUNC">(</span><span class="NAME">DwtEvent.ONMOUSEDOWN</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._mouseDownListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 95</span> </span><span class="WHIT">	</span><span class="NAME">this._reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 96</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 97</span> 
<span class="line"> 98</span> </span><span class="NAME">ZmAddressInputField.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DwtComposite</span><span class="PUNC">;</span><span class="WHIT">
<span class="line"> 99</span> </span><span class="NAME">ZmAddressInputField.prototype.constructor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">100</span> 
<span class="line">101</span> </span><span class="NAME">ZmAddressInputField.prototype.isZmAddressInputField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">102</span> </span><span class="NAME">ZmAddressInputField.prototype.isInputControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">103</span> </span><span class="COMM">//ZmAddressInputField.prototype.role = &#39;combobox&#39;;</span><span class="WHIT">
<span class="line">104</span> </span><span class="NAME">ZmAddressInputField.prototype.toString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">&#34;ZmAddressInputField&#34;</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">105</span> 
<span class="line">106</span> </span><span class="NAME">ZmAddressInputField.prototype.TEMPLATE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;share.Widgets#ZmAddressInputField&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">107</span> 
<span class="line">108</span> </span><span class="NAME">ZmAddressInputField.INPUT_EXTRA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="COMM">// extra width for the INPUT</span><span class="WHIT">
<span class="line">109</span> </span><span class="NAME">ZmAddressInputField.INPUT_EXTRA_SMALL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// edit mode</span><span class="WHIT">
<span class="line">110</span> 
<span class="line">111</span> </span><span class="COMM">// tie a bubble SPAN to a widget that can handle clicks</span><span class="WHIT">
<span class="line">112</span> </span><span class="NAME">ZmAddressInputField.BUBBLE_OBJ_ID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">113</span> 
<span class="line">114</span> </span><span class="COMM">// several ZmAddressInputField&#39;s can share an action menu, so save context statically</span><span class="WHIT">
<span class="line">115</span> </span><span class="NAME">ZmAddressInputField.menuContext</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">116</span> 
<span class="line">117</span> </span><span class="NAME">ZmAddressInputField.prototype.setAutocompleteListView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">118</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aclv</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">119</span> </span><span class="WHIT">	</span><span class="NAME">this._aclv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aclv</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">120</span> </span><span class="WHIT">	</span><span class="NAME">this._separator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">aclv._separator</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">AjxEmailAddress.SEPARATOR</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">121</span> </span><span class="WHIT">	</span><span class="NAME">aclv.addCallback</span><span class="PUNC">(</span><span class="NAME">ZmAutocompleteListView.CB_KEYDOWN</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._keyDownCallback.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._inputId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">122</span> </span><span class="WHIT">	</span><span class="NAME">aclv.addCallback</span><span class="PUNC">(</span><span class="NAME">ZmAutocompleteListView.CB_KEYUP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._keyUpCallback.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._inputId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">123</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">124</span> 
<span class="line">125</span> </span><span class="COMM">// Override since we normally want to add bubble before the INPUT, and not at the end. If we&#39;re</span><span class="WHIT">
<span class="line">126</span> </span><span class="COMM">// leaving edit mode, we want to put the bubble back where it was via the index.</span><span class="WHIT">
<span class="line">127</span> </span><span class="NAME">ZmAddressInputField.prototype.addChild</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">128</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">129</span> 
<span class="line">130</span> </span><span class="WHIT">	</span><span class="NAME">DwtComposite.prototype.addChild.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">131</span> 
<span class="line">132</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">child.getHtmlElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">133</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._input.parentNode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this._holder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">134</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">refElement</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">135</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">136</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">refBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getBubbleList</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getBubble</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">137</span> </span><span class="WHIT">			</span><span class="NAME">refElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">refBubble</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">refBubble.getHtmlElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">138</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">139</span> </span><span class="WHIT">		</span><span class="NAME">this._holder.insertBefore</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">refElement</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._input</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">140</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">141</span> </span><span class="WHIT">		</span><span class="NAME">this._holder.appendChild</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">142</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">143</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">144</span> 
<span class="line">145</span> </span><span class="COMM">/**
<span class="line">146</span>  * Creates a bubble for the given address and adds it into the holding area. If the address
<span class="line">147</span>  * is a local group, it is expanded and the members are added individually.
<span class="line">148</span>  *
<span class="line">149</span>  * @param {hash}				params		hash of params:
<span class="line">150</span>  * @param {string}				address		address text to go in the bubble
<span class="line">151</span>  * @param {ZmAutocompleteMatch}	match		match object
<span class="line">152</span>  * @param {ZmAddressBubble}		bubble		bubble to clone
<span class="line">153</span>  * @param {int}					index		position (relative to bubbles, not elements) at which to add bubble
<span class="line">154</span>  * @param {boolean}				skipNotify	if true, don&#39;t call bubbleAddedCallback
<span class="line">155</span>  * @param {boolean}				noFocus		if true, don&#39;t focus input after bubble is added
<span class="line">156</span>  * @param {string}				addClass	additional class name for bubble
<span class="line">157</span>  * @param {boolean}				noParse		if true, do not parse content to see if it is an address
<span class="line">158</span>  */</span><span class="WHIT">
<span class="line">159</span> </span><span class="NAME">ZmAddressInputField.prototype.addBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">160</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">161</span> 
<span class="line">162</span> </span><span class="WHIT">	</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">163</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">params.address</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">params.bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">164</span> </span><span class="WHIT">	
<span class="line">165</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">166</span> </span><span class="WHIT">		</span><span class="NAME">params.address</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.bubble.address</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">167</span> </span><span class="WHIT">		</span><span class="NAME">params.match</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.bubble.match</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">168</span> </span><span class="WHIT">		</span><span class="NAME">params.canExpand</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.bubble.canExpand</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">169</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">170</span> </span><span class="WHIT">	</span><span class="NAME">params.parent</span><span class="WHIT">		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">171</span> </span><span class="WHIT">	</span><span class="NAME">params.addrInput</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">172</span> </span><span class="WHIT">	</span><span class="NAME">params.parentId</span><span class="WHIT">		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._htmlElId</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">173</span> </span><span class="WHIT">	</span><span class="NAME">params.className</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._bubbleClassName</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class="line">174</span> </span><span class="WHIT">	</span><span class="NAME">params.canRemove</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">175</span> </span><span class="WHIT">	</span><span class="NAME">params.separator</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._separator</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">176</span> </span><span class="WHIT">	</span><span class="NAME">params.type</span><span class="WHIT">			</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.type</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">177</span> </span><span class="WHIT">	
<span class="line">178</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.index</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._editModeIndex</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">179</span> </span><span class="WHIT">		</span><span class="NAME">params.index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getInsertionIndex</span><span class="PUNC">(</span><span class="NAME">this._holder.childNodes</span><span class="PUNC">[</span><span class="NAME">this._editModeIndex</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">180</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">181</span> </span><span class="WHIT">	
<span class="line">182</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bubbleAdded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">183</span> </span><span class="WHIT">	
<span class="line">184</span> 	</span><span class="COMM">// if it&#39;s a local group, expand it and add each address separately</span><span class="WHIT">
<span class="line">185</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">match</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.match</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">186</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">match</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">match.isGroup</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">match.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ZmAutocomplete.AC_TYPE_CONTACT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">187</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxEmailAddress.split</span><span class="PUNC">(</span><span class="NAME">params.address</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">188</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addrs.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">189</span> </span><span class="WHIT">			</span><span class="NAME">params.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.addrObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.match</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.email</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.canExpand</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">190</span> </span><span class="WHIT">			</span><span class="NAME">params.address</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addrs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">191</span> </span><span class="WHIT">			</span><span class="NAME">params.index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.index</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">params.index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">192</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._hasValidAddress</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">193</span> </span><span class="WHIT">				</span><span class="NAME">this._addBubble</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ZmAddressBubble</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">194</span> </span><span class="WHIT">				</span><span class="NAME">bubbleAdded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">195</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">196</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">197</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">198</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">199</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._hasValidAddress</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">200</span> </span><span class="WHIT">			</span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ZmAddressBubble</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">201</span> </span><span class="WHIT">			</span><span class="NAME">this._addBubble</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.noFocus</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">202</span> </span><span class="WHIT">			</span><span class="NAME">bubbleAdded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">203</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">204</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">205</span> </span><span class="WHIT">			</span><span class="COMM">// if handed a non-address while in strict mode, append it to the INPUT and bail</span><span class="WHIT">
<span class="line">206</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._input.value</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">207</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this._separator</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">&#34;&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">208</span> </span><span class="WHIT">			</span><span class="NAME">this._setInputValue</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.address</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">&#34;&#34;</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">209</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">210</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">211</span> 
<span class="line">212</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bubbleAdded</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">213</span> </span><span class="WHIT">		</span><span class="NAME">this._holder.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;addrBubbleHolder&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">214</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._bubbleAddedCallback</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">params.skipNotify</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">215</span> </span><span class="WHIT">			</span><span class="NAME">this._bubbleAddedCallback.run</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">216</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">217</span> </span><span class="WHIT">		</span><span class="NAME">this._leaveEditMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">218</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">219</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">220</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">221</span> 
<span class="line">222</span> </span><span class="NAME">ZmAddressInputField.prototype._addBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">223</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">noFocus</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">224</span> 
<span class="line">225</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._singleBubble</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._numBubbles</span><span class="WHIT"> </span><span class="PUNC">&gt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">226</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">227</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">228</span> </span><span class="WHIT">	
<span class="line">229</span> 	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif1&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;ADD bubble: &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">AjxStringUtil.htmlEncode</span><span class="PUNC">(</span><span class="NAME">bubble.address</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">230</span> </span><span class="WHIT">	</span><span class="NAME">bubble.setDropTarget</span><span class="PUNC">(</span><span class="NAME">this.getDropTarget</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">231</span> </span><span class="WHIT">	</span><span class="NAME">this._bubbleList.add</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">232</span> </span><span class="WHIT">	</span><span class="NAME">this._numBubbles</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">233</span> 
<span class="line">234</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubbleId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble._htmlElId</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">235</span> </span><span class="WHIT">	</span><span class="NAME">this._bubble</span><span class="PUNC">[</span><span class="NAME">bubbleId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">236</span> </span><span class="WHIT">	</span><span class="NAME">this._addressHash</span><span class="PUNC">[</span><span class="NAME">bubble.hashKey</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubbleId</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">237</span> 
<span class="line">238</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">noFocus</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">239</span> </span><span class="WHIT">		</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">240</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">241</span> 
<span class="line">242</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._singleBubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">243</span> </span><span class="WHIT">		</span><span class="NAME">this._setInputEnabled</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">244</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">245</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">246</span> 
<span class="line">247</span> </span><span class="NAME">ZmAddressInputField.prototype.getAddressBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">248</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">email</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">249</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._addressHash</span><span class="PUNC">[</span><span class="NAME">email</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">250</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">251</span> 
<span class="line">252</span> </span><span class="NAME">ZmAddressInputField.prototype._hasValidAddress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">253</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">254</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._strictMode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">255</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">256</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">257</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.addrObj</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">params.addrObj.getAddress</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.address</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.match</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">params.match.email</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">258</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Boolean</span><span class="PUNC">(</span><span class="NAME">AjxEmailAddress.parse</span><span class="PUNC">(</span><span class="NAME">addr</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">259</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">260</span> 
<span class="line">261</span> </span><span class="COMM">/**
<span class="line">262</span>  * Removes the bubble with the given ID from the holding area.
<span class="line">263</span>  *
<span class="line">264</span>  * @param {string}	bubbleId	ID of bubble to remove
<span class="line">265</span>  * @param {boolean}	skipNotify	if true, don&#39;t call bubbleRemovedCallback
<span class="line">266</span>  */</span><span class="WHIT">
<span class="line">267</span> </span><span class="NAME">ZmAddressInputField.prototype.removeBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">268</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubbleId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipNotify</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">269</span> 
<span class="line">270</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtControl.fromElementId</span><span class="PUNC">(</span><span class="NAME">bubbleId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">271</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">272</span> </span><span class="WHIT">	
<span class="line">273</span> 	</span><span class="NAME">this._bubbleList.remove</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">274</span> 
<span class="line">275</span> </span><span class="WHIT">	</span><span class="NAME">bubble.dispose</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">276</span> 
<span class="line">277</span> </span><span class="WHIT">	</span><span class="NAME">this._bubble</span><span class="PUNC">[</span><span class="NAME">bubbleId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">278</span> </span><span class="WHIT">	</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._bubble</span><span class="PUNC">[</span><span class="NAME">bubbleId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">279</span> </span><span class="WHIT">	</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._addressHash</span><span class="PUNC">[</span><span class="NAME">bubble.hashKey</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">280</span> </span><span class="WHIT">	</span><span class="NAME">this._numBubbles</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">281</span> 
<span class="line">282</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._numBubbles</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">283</span> </span><span class="WHIT">		</span><span class="NAME">this._holder.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;addrBubbleHolder-empty&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">284</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">285</span> 
<span class="line">286</span> </span><span class="WHIT">	</span><span class="NAME">this._resizeInput</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">287</span> 
<span class="line">288</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._bubbleRemovedCallback</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">skipNotify</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">289</span> </span><span class="WHIT">		</span><span class="NAME">this._bubbleRemovedCallback.run</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">290</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">291</span> 
<span class="line">292</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._singleBubble</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._numBubbles</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">293</span> </span><span class="WHIT">		</span><span class="NAME">this._setInputEnabled</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">294</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">295</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">296</span> 
<span class="line">297</span> </span><span class="COMM">/**
<span class="line">298</span>  * Removes all bubbles from the holding area.
<span class="line">299</span>  */</span><span class="WHIT">
<span class="line">300</span> </span><span class="NAME">ZmAddressInputField.prototype.clear</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">301</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">skipNotify</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">302</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">303</span> </span><span class="WHIT">		</span><span class="NAME">this.removeBubble</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipNotify</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">304</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">305</span> </span><span class="WHIT">	</span><span class="NAME">this._reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">306</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">307</span> 
<span class="line">308</span> </span><span class="COMM">/**
<span class="line">309</span>  * Returns a string of concatenated bubble addresses.
<span class="line">310</span>  */</span><span class="WHIT">
<span class="line">311</span> </span><span class="NAME">ZmAddressInputField.prototype.getValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">312</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">313</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">list</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getAddresses</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">314</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._input.value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">315</span> </span><span class="WHIT">		</span><span class="NAME">list.push</span><span class="PUNC">(</span><span class="NAME">this._input.value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">316</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">317</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">list.join</span><span class="PUNC">(</span><span class="NAME">this._separator</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">318</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">319</span> 
<span class="line">320</span> </span><span class="COMM">/**
<span class="line">321</span>  * Parses the given text into email addresses, and adds a bubble for each one
<span class="line">322</span>  * that we don&#39;t already have. Since text is passed in, we don&#39;t recognize expandable DLs.
<span class="line">323</span>  * A bubble may be added for a string even if it doesn&#39;t parse as an email address.
<span class="line">324</span>  *
<span class="line">325</span>  * @param {string}	text				email addresses
<span class="line">326</span>  * @param {boolean}	add					if true, control is not cleared first
<span class="line">327</span>  * @param {boolean}	skipNotify			if true, don&#39;t call bubbleAddedCallback
<span class="line">328</span>  * @param {boolean}	invokeAutocomplete	if true, trigger autocomplete
<span class="line">329</span>  * 										(useful in paste event when keyup/down events don&#39;t take place
<span class="line">330</span>  */</span><span class="WHIT">
<span class="line">331</span> </span><span class="NAME">ZmAddressInputField.prototype.setValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">332</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipNotify</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">invokeAutocomplete</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">333</span> 
<span class="line">334</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">add</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">335</span> </span><span class="WHIT">		</span><span class="NAME">this.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">336</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">337</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">text</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">338</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">339</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">340</span> 
<span class="line">341</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">342</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._editModeIndex</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">343</span> </span><span class="WHIT">		</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getInsertionIndex</span><span class="PUNC">(</span><span class="NAME">this._holder.childNodes</span><span class="PUNC">[</span><span class="NAME">this._editModeIndex</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">344</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">345</span> 
<span class="line">346</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxEmailAddress.parseEmailString</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">347</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">good</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bad</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">348</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ZmId.SEARCH</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">349</span> </span><span class="WHIT">		</span><span class="COMM">// search field query isn&#39;t supposed to be validated for emails</span><span class="WHIT">
<span class="line">350</span> </span><span class="WHIT">		</span><span class="NAME">good</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addrs.all.getArray</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">351</span> </span><span class="WHIT">		</span><span class="NAME">bad</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">352</span> </span><span class="WHIT">		</span><span class="COMM">// skip notify because we don&#39;t need to trigger search on text to bubble conversion</span><span class="WHIT">
<span class="line">353</span> </span><span class="WHIT">		</span><span class="NAME">skipNotify</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">354</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">355</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">356</span> </span><span class="WHIT">		</span><span class="NAME">good</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addrs.good.getArray</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">357</span> </span><span class="WHIT">		</span><span class="NAME">bad</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addrs.bad.getArray</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">358</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">359</span> 
<span class="line">360</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">good.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">361</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">good</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">362</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">addr</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this._addressHash</span><span class="PUNC">[</span><span class="NAME">addr.address</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">363</span> </span><span class="WHIT">			</span><span class="NAME">this.addBubble</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class="line">364</span> </span><span class="WHIT">				</span><span class="NAME">address</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">addr.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">365</span> </span><span class="WHIT">				</span><span class="NAME">addrObj</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">addr</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">366</span> </span><span class="WHIT">				</span><span class="NAME">index</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">367</span> </span><span class="WHIT">				</span><span class="NAME">skipNotify</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">skipNotify</span><span class="WHIT">
<span class="line">368</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">369</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">370</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">371</span> 
<span class="line">372</span> </span><span class="WHIT">	</span><span class="NAME">this._setInputValue</span><span class="PUNC">(</span><span class="NAME">bad.length</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">bad.join</span><span class="PUNC">(</span><span class="NAME">this._separator</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">&#34;&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">373</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">invokeAutocomplete</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">bad.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">374</span> </span><span class="WHIT">		</span><span class="NAME">this._aclv.autocomplete</span><span class="PUNC">(</span><span class="NAME">this.getInputElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">375</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">376</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">377</span> 
<span class="line">378</span> </span><span class="COMM">/**
<span class="line">379</span>  * Sets the value of the input without looking for email addresses. No bubbles will be added.
<span class="line">380</span>  * 
<span class="line">381</span>  * @param {string}	text		new input content
<span class="line">382</span>  */</span><span class="WHIT">
<span class="line">383</span> </span><span class="NAME">ZmAddressInputField.prototype.setInputValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">384</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">385</span> </span><span class="WHIT">	</span><span class="NAME">this._input.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">text</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">386</span> </span><span class="WHIT">	</span><span class="NAME">this._resizeInput</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">387</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">388</span> 
<span class="line">389</span> </span><span class="COMM">/**
<span class="line">390</span>  * Adds address(es) to the input.
<span class="line">391</span>  * 
<span class="line">392</span>  * @param {string}	text		email addresses
<span class="line">393</span>  * @param {boolean}	skipNotify	if true, don&#39;t call bubbleAddedCallback
<span class="line">394</span>  */</span><span class="WHIT">
<span class="line">395</span> </span><span class="NAME">ZmAddressInputField.prototype.addValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">396</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipNotify</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">397</span> </span><span class="WHIT">	</span><span class="NAME">this.setValue</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipNotify</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">398</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">399</span> 
<span class="line">400</span> </span><span class="COMM">/**
<span class="line">401</span>  * Removes the selected bubble. If none are selected, selects the last one.
<span class="line">402</span>  *
<span class="line">403</span>  * @param {boolean}		checkInput		if true, make sure INPUT is empty
<span class="line">404</span>  *
<span class="line">405</span>  * @return {boolean}	true if the delete selected or removed a bubble
<span class="line">406</span>  */</span><span class="WHIT">
<span class="line">407</span> </span><span class="NAME">ZmAddressInputField.prototype.handleDelete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">408</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">checkInput</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">409</span> 
<span class="line">410</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">checkInput</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._input.value.length</span><span class="WHIT"> </span><span class="PUNC">&gt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">411</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">412</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">413</span> 
<span class="line">414</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">415</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">416</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">417</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">418</span> </span><span class="WHIT">				</span><span class="NAME">this.removeBubble</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">419</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">420</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">421</span> </span><span class="WHIT">		</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">422</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">423</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">424</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">425</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._selectBubbleBeforeInput</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">426</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">427</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">428</span> 
<span class="line">429</span> </span><span class="COMM">// Selects the bubble to the left of the (empty) INPUT, if there is one.</span><span class="WHIT">
<span class="line">430</span> </span><span class="NAME">ZmAddressInputField.prototype._selectBubbleBeforeInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">431</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">432</span> </span><span class="WHIT">	
<span class="line">433</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._input.value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">434</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getInputIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">435</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">span</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&gt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._holder.childNodes</span><span class="PUNC">[</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">436</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtControl.fromElement</span><span class="PUNC">(</span><span class="NAME">span</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">437</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">438</span> </span><span class="WHIT">			</span><span class="NAME">this.setSelected</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">439</span> </span><span class="WHIT">			</span><span class="NAME">this.blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">440</span> </span><span class="WHIT">			</span><span class="NAME">appCtxt.getKeyboardMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">grabFocus</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">441</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">442</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">443</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">444</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">445</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">446</span> 
<span class="line">447</span> </span><span class="COMM">/**
<span class="line">448</span>  * Sets selection of the given bubble.
<span class="line">449</span>  *
<span class="line">450</span>  * @param {Element}	bubble		bubble to select
<span class="line">451</span>  * @param {boolean} selected	if true, select the bubble, otherwise deselect it
<span class="line">452</span>  */</span><span class="WHIT">
<span class="line">453</span> </span><span class="NAME">ZmAddressInputField.prototype.setSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">454</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">455</span> </span><span class="WHIT">	</span><span class="NAME">this._bubbleList.setSelected</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">456</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">457</span> 
<span class="line">458</span> </span><span class="COMM">/**
<span class="line">459</span>  * Returns a list of the currently selected bubbles. If a bubble has been selected via right-click,
<span class="line">460</span>  * but is not part of the current left-click selection, only it will be returned.
<span class="line">461</span>  *
<span class="line">462</span>  * @param {ZmAddressBubble}	bubble	reference bubble
<span class="line">463</span>  */</span><span class="WHIT">
<span class="line">464</span> </span><span class="NAME">ZmAddressInputField.prototype.getSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">465</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">466</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._bubbleList.getSelection</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">467</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">468</span> 
<span class="line">469</span> </span><span class="NAME">ZmAddressInputField.prototype.getSelectionCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">470</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">471</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._bubbleList.getSelectionCount</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">472</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">473</span> 
<span class="line">474</span> </span><span class="NAME">ZmAddressInputField.prototype.deselectAll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">475</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">476</span> </span><span class="WHIT">	</span><span class="NAME">this._bubbleList.deselectAll</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">477</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">478</span> 
<span class="line">479</span> </span><span class="NAME">ZmAddressInputField.prototype.preventSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">480</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">targetEl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">481</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this._bubble</span><span class="PUNC">[</span><span class="NAME">targetEl.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.__isInputEl</span><span class="PUNC">(</span><span class="NAME">targetEl</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">482</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">483</span> 
<span class="line">484</span> </span><span class="NAME">ZmAddressInputField.prototype.getTabGroupMember</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">485</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">486</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._tabGroup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">487</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._tabGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DwtTabGroup</span><span class="PUNC">(</span><span class="STRN">&#39;ZmAddressInputField&#39;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">488</span> 
<span class="line">489</span> </span><span class="WHIT">		</span><span class="COMM">// the composite tab group includes regular children of the control; in</span><span class="WHIT">
<span class="line">490</span> </span><span class="WHIT">		</span><span class="COMM">// this instance the address bubbles -- we want that, and our raw input</span><span class="WHIT">
<span class="line">491</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtComposite.prototype.getTabGroupMember.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">492</span> 
<span class="line">493</span> </span><span class="WHIT">		</span><span class="NAME">tg.addMember</span><span class="PUNC">(</span><span class="NAME">ctg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">494</span> </span><span class="WHIT">		</span><span class="NAME">tg.addMember</span><span class="PUNC">(</span><span class="NAME">this.getInputElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">495</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">496</span> 
<span class="line">497</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._tabGroup</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">498</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">499</span> 
<span class="line">500</span> 
<span class="line">501</span> </span><span class="COMM">/**
<span class="line">502</span>  * Makes bubbles out of addresses in pasted text.
<span class="line">503</span>  *
<span class="line">504</span>  * @param ev
<span class="line">505</span>  */</span><span class="WHIT">
<span class="line">506</span> </span><span class="NAME">ZmAddressInputField.onPaste</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">507</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">508</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField._getAddrInputFromEvent</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">509</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">addrInput</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">510</span> </span><span class="WHIT">		</span><span class="COMM">// trigger autocomplete after paste to accommodate  mouse click pastes</span><span class="WHIT">
<span class="line">511</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">invokeAutocomplete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">512</span> </span><span class="WHIT">		</span><span class="COMM">// give browser time to update input - easier than dealing with clipboard</span><span class="WHIT">
<span class="line">513</span> </span><span class="WHIT">		</span><span class="COMM">// will also resize the INPUT</span><span class="WHIT">
<span class="line">514</span> </span><span class="WHIT">		</span><span class="NAME">AjxTimedAction.scheduleAction</span><span class="PUNC">(</span><span class="WHIT">
<span class="line">515</span> </span><span class="WHIT">			</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AjxTimedAction</span><span class="PUNC">(</span><span class="WHIT">
<span class="line">516</span> </span><span class="WHIT">				</span><span class="NAME">addrInput</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">517</span> </span><span class="WHIT">				</span><span class="NAME">addrInput._checkInput</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">518</span> </span><span class="WHIT">				</span><span class="PUNC">[</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">invokeAutocomplete</span><span class="PUNC">]</span><span class="WHIT">
<span class="line">519</span> </span><span class="WHIT">			</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT">
<span class="line">520</span> </span><span class="WHIT">		</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">521</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">522</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">523</span> 
<span class="line">524</span> </span><span class="NAME">ZmAddressInputField.onCut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">525</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">526</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField._getAddrInputFromEvent</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">527</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">addrInput</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">528</span> </span><span class="WHIT">		</span><span class="NAME">addrInput._resizeInput</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">529</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">530</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">531</span> 
<span class="line">532</span> </span><span class="COMM">/**
<span class="line">533</span>  * Handle arrow up, arrow down for bubble holder
<span class="line">534</span>  *
<span class="line">535</span>  * @param ev
<span class="line">536</span>  */</span><span class="WHIT">
<span class="line">537</span> </span><span class="NAME">ZmAddressInputField.onHolderKeyClick</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">538</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">539</span> </span><span class="WHIT">    </span><span class="NAME">ev</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtUiEvent.getEvent</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">540</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtKeyEvent.getCharCode</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">541</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">38</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">542</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.clientHeight</span><span class="WHIT"> </span><span class="PUNC">&gt;=</span><span class="WHIT"> </span><span class="NAME">this.scrollHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">543</span> </span><span class="WHIT">	    </span><span class="NAME">this.scrollTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">this.scrollTop</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.clientHeight</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">544</span> </span><span class="WHIT">        </span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;this.scrollTop  = &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.scrollTop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">545</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">546</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">40</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">547</span> </span><span class="WHIT">         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.clientHeight</span><span class="WHIT"> </span><span class="PUNC">&gt;=</span><span class="WHIT"> </span><span class="NAME">this.scrollHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">548</span> </span><span class="WHIT">	     </span><span class="NAME">this.scrollTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">this.scrollTop</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.clientHeight</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.scrollHeight</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.clientHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">549</span> </span><span class="WHIT">         </span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;this.scrollTop  = &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.scrollTop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">550</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">551</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">552</span> 
<span class="line">553</span> </span><span class="COMM">// looks for valid addresses in the input, and converts them to bubbles</span><span class="WHIT">
<span class="line">554</span> </span><span class="NAME">ZmAddressInputField.prototype._checkInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">555</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">invokeAutocomplete</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">556</span> </span><span class="WHIT">	</span><span class="NAME">text</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">text</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._input.value</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">557</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;CHECK input: &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">AjxStringUtil.htmlEncode</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">558</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">559</span> </span><span class="WHIT">		</span><span class="NAME">this.setValue</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">invokeAutocomplete</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">560</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">561</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">562</span> 
<span class="line">563</span> </span><span class="COMM">// focus input when holder div is clicked</span><span class="WHIT">
<span class="line">564</span> </span><span class="NAME">ZmAddressInputField.onHolderClick</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">565</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">566</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;ZmAddressInputField.onHolderClick&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">567</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField._getAddrInputFromEvent</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">568</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">addrInput</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">569</span> </span><span class="WHIT">		</span><span class="NAME">addrInput.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">570</span> 
<span class="line">571</span> </span><span class="WHIT">		</span><span class="COMM">// bug 85036: ensure caret visibility on IE by resetting the selection</span><span class="WHIT">
<span class="line">572</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">input</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addrInput.getInputElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">573</span> </span><span class="WHIT">		</span><span class="NAME">Dwt.setSelectionRange</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Dwt.getSelectionStart</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">574</span> </span><span class="WHIT">		                      </span><span class="NAME">Dwt.getSelectionEnd</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">575</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">576</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">577</span> 
<span class="line">578</span> </span><span class="COMM">/**
<span class="line">579</span>  * Removes the bubble with the given ID from the holding area.
<span class="line">580</span>  *
<span class="line">581</span>  * @param {string}	bubbleId	ID of bubble to remove
<span class="line">582</span>  * @param {boolean}	skipNotify	if true, don&#39;t call bubbleRemovedCallback
<span class="line">583</span>  *
<span class="line">584</span>  */</span><span class="WHIT">
<span class="line">585</span> </span><span class="NAME">ZmAddressInputField.removeBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">586</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubbleId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipNotify</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">587</span> 
<span class="line">588</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">bubbleId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">589</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;REMOVE bubble: &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">AjxStringUtil.htmlEncode</span><span class="PUNC">(</span><span class="NAME">bubble.address</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">590</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parentId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble._aifId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.BUBBLE_OBJ_ID</span><span class="PUNC">[</span><span class="NAME">bubbleId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">591</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">DwtControl.ALL_BY_ID</span><span class="PUNC">[</span><span class="NAME">parentId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">592</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">addrInput.getEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">593</span> </span><span class="WHIT">		</span><span class="NAME">addrInput.removeBubble</span><span class="PUNC">(</span><span class="NAME">bubbleId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipNotify</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">594</span> </span><span class="WHIT">		</span><span class="NAME">addrInput.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">595</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">596</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">597</span> 
<span class="line">598</span> </span><span class="NAME">ZmAddressInputField.prototype.getInputElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">599</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">600</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._input</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">601</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">602</span> 
<span class="line">603</span> </span><span class="NAME">ZmAddressInputField.prototype.setEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">604</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enabled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">605</span> </span><span class="WHIT">	</span><span class="NAME">DwtControl.prototype.setEnabled.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">enabled</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">606</span> </span><span class="WHIT">	</span><span class="NAME">this._input.disabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">enabled</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">607</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">608</span> 
<span class="line">609</span> </span><span class="COMM">/**
<span class="line">610</span>  * Enables or disables the input without affecting the bubbles.
<span class="line">611</span>  *
<span class="line">612</span>  * @param {boolean} enabled		enable input if true, disable if false
<span class="line">613</span>  */</span><span class="WHIT">
<span class="line">614</span> </span><span class="NAME">ZmAddressInputField.prototype._setInputEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">615</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enabled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">616</span> </span><span class="WHIT">	</span><span class="NAME">this._input.disabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">enabled</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">617</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">618</span> 
<span class="line">619</span> </span><span class="NAME">ZmAddressInputField.prototype._initialize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">620</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">621</span> 
<span class="line">622</span> </span><span class="WHIT">	</span><span class="NAME">this._holderId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Dwt.getNextId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">623</span> </span><span class="WHIT">	</span><span class="NAME">this._inputId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.inputId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">Dwt.getNextId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">624</span> </span><span class="WHIT">	</span><span class="NAME">this._label</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.label</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">625</span> </span><span class="WHIT">	</span><span class="NAME">this._dragInsertionBarId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Dwt.getNextId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">626</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">627</span> </span><span class="WHIT">		</span><span class="NAME">inputTagName</span><span class="PUNC">:</span><span class="WHIT">		</span><span class="NAME">AjxEnv.isIE</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">AjxEnv.isModernIE</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">
<span class="line">628</span> </span><span class="WHIT">								</span><span class="STRN">&#39;textarea&#39;</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">&#39;input&#39;</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">629</span> </span><span class="WHIT">		</span><span class="NAME">holderId</span><span class="PUNC">:</span><span class="WHIT">			</span><span class="NAME">this._holderId</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">630</span> </span><span class="WHIT">		</span><span class="NAME">inputId</span><span class="PUNC">:</span><span class="WHIT">			</span><span class="NAME">this._inputId</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">631</span> </span><span class="WHIT">		</span><span class="NAME">label</span><span class="PUNC">:</span><span class="WHIT">				</span><span class="NAME">this._label</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">632</span> </span><span class="WHIT">		</span><span class="NAME">dragInsertionBarId</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">this._dragInsertionBarId</span><span class="WHIT">
<span class="line">633</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">634</span> </span><span class="WHIT">	</span><span class="NAME">this._createHtmlFromTemplate</span><span class="PUNC">(</span><span class="NAME">params.templateId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.TEMPLATE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">635</span> 
<span class="line">636</span> </span><span class="WHIT">	</span><span class="NAME">this._holder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">this._holderId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">637</span> </span><span class="WHIT">	</span><span class="NAME">this._holder._aifId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._htmlElId</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">638</span> </span><span class="WHIT">	</span><span class="NAME">this._input</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">this._inputId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">639</span> </span><span class="WHIT">	</span><span class="NAME">this._input.supportsAutoComplete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">640</span> </span><span class="WHIT">	</span><span class="NAME">this._dragInsertionBar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">this._dragInsertionBarId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">641</span> 
<span class="line">642</span> </span><span class="WHIT">	</span><span class="NAME">Dwt.setHandler</span><span class="PUNC">(</span><span class="NAME">this._holder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONCLICK</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.onHolderClick</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">643</span> </span><span class="WHIT">	</span><span class="NAME">Dwt.setHandler</span><span class="PUNC">(</span><span class="NAME">this._input</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONCUT</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.onCut</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">644</span> </span><span class="WHIT">	</span><span class="NAME">Dwt.setHandler</span><span class="PUNC">(</span><span class="NAME">this._input</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONPASTE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.onPaste</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">645</span> </span><span class="WHIT">    </span><span class="NAME">Dwt.setHandler</span><span class="PUNC">(</span><span class="NAME">this._holder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONKEYDOWN</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.onHolderKeyClick</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">646</span> 
<span class="line">647</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">this._holder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">threshold</span><span class="PUNC">:</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">amount</span><span class="PUNC">:</span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">interval</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">this._holderId</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">648</span> </span><span class="WHIT">    </span><span class="NAME">this._dndScrollCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtControl._dndScrollCallback.bind</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">args</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">649</span> </span><span class="WHIT">    </span><span class="NAME">this._dndScrollId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._holderId</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">650</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">651</span> 
<span class="line">652</span> </span><span class="NAME">ZmAddressInputField.prototype._reset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">653</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">654</span> 
<span class="line">655</span> </span><span class="WHIT">	</span><span class="NAME">this._bubble</span><span class="WHIT">		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// bubbles by bubble ID</span><span class="WHIT">
<span class="line">656</span> </span><span class="WHIT">	</span><span class="NAME">this._addressHash</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// used addresses, so we can check for dupes</span><span class="WHIT">
<span class="line">657</span> 
<span class="line">658</span> </span><span class="WHIT">	</span><span class="NAME">this._numBubbles</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">659</span> 
<span class="line">660</span> </span><span class="WHIT">	</span><span class="NAME">this._bubbleList.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">661</span> 
<span class="line">662</span> </span><span class="WHIT">	</span><span class="NAME">this._editMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">663</span> </span><span class="WHIT">	</span><span class="NAME">this._editModeIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._editModeBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">664</span> 
<span class="line">665</span> </span><span class="WHIT">	</span><span class="NAME">this._dragInsertionBarIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// node index vertical bar indicating insertion point</span><span class="WHIT">
<span class="line">666</span> 
<span class="line">667</span> </span><span class="WHIT">	</span><span class="NAME">this._holder.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;addrBubbleHolder-empty&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">668</span> </span><span class="WHIT">	</span><span class="NAME">this._setInputValue</span><span class="PUNC">(</span><span class="STRN">&#34;&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">669</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">670</span> 
<span class="line">671</span> </span><span class="COMM">/**
<span class="line">672</span>  * Sets focus to the INPUT.
<span class="line">673</span>  */</span><span class="WHIT">
<span class="line">674</span> </span><span class="NAME">ZmAddressInputField.prototype.focus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">675</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">676</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">677</span> </span><span class="WHIT">		</span><span class="NAME">appCtxt.getKeyboardMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">grabFocus</span><span class="PUNC">(</span><span class="NAME">this._input</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">678</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">679</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">680</span> 
<span class="line">681</span> </span><span class="COMM">/**
<span class="line">682</span>  * Blurs this control.
<span class="line">683</span>  */</span><span class="WHIT">
<span class="line">684</span> </span><span class="NAME">ZmAddressInputField.prototype.blur</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">685</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">686</span> </span><span class="WHIT">	</span><span class="NAME">this._input.blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">687</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">688</span> 
<span class="line">689</span> </span><span class="NAME">ZmAddressInputField.prototype.moveCursorToEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">690</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">691</span> </span><span class="WHIT">	</span><span class="NAME">Dwt.moveCursorToEnd</span><span class="PUNC">(</span><span class="NAME">this._input</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">692</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">693</span> 
<span class="line">694</span> </span><span class="NAME">ZmAddressInputField.prototype._setInputValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">695</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">696</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;SET input value to: &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">AjxStringUtil.htmlEncode</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">697</span> </span><span class="WHIT">	</span><span class="NAME">this._input.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">value.replace</span><span class="PUNC">(</span><span class="REGX">/\s+/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#39; &#39;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">698</span> </span><span class="WHIT">	</span><span class="NAME">this._resizeInput</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">699</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">700</span> 
<span class="line">701</span> </span><span class="COMM">// Handles key events that occur in the INPUT.</span><span class="WHIT">
<span class="line">702</span> </span><span class="NAME">ZmAddressInputField.prototype._keyDownCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">703</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aclv</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">704</span> </span><span class="WHIT">	</span><span class="NAME">ev</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtUiEvent.getEvent</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">705</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtKeyEvent.getCharCode</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">706</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propagate</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">707</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clearInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">708</span> </span><span class="WHIT">	
<span class="line">709</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">DwtKeyMapMgr.hasModifier</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ev.shiftKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">710</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">propagate</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">711</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">712</span> 
<span class="line">713</span> </span><span class="WHIT">	</span><span class="COMM">// Esc in edit mode restores the original address to the bubble</span><span class="WHIT">
<span class="line">714</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">27</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._editMode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">715</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;_keyDownCallback found ESC key in edit mode&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">716</span> </span><span class="WHIT">		</span><span class="NAME">this._leaveEditMode</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">717</span> </span><span class="WHIT">		</span><span class="NAME">propagate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// eat the event - eg don&#39;t let compose view catch Esc and pop the view</span><span class="WHIT">
<span class="line">718</span> </span><span class="WHIT">		</span><span class="NAME">clearInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">719</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">720</span> </span><span class="WHIT">	</span><span class="COMM">// Del removes selected bubbles, or selects last bubble if there is no input</span><span class="WHIT">
<span class="line">721</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">722</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;_keyDownCallback found DEL key&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">723</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.handleDelete</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">724</span> </span><span class="WHIT">			</span><span class="NAME">propagate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">725</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">726</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">727</span> </span><span class="WHIT">	</span><span class="COMM">// Left arrow selects last bubble if there is no input</span><span class="WHIT">
<span class="line">728</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">37</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">729</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;_keyDownCallback found left arrow&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">730</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._selectBubbleBeforeInput</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">731</span> </span><span class="WHIT">			</span><span class="NAME">propagate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">732</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">733</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">734</span> </span><span class="WHIT">	</span><span class="COMM">// Handle case where user is leaving edit while we&#39;re not in strict mode</span><span class="WHIT">
<span class="line">735</span> </span><span class="WHIT">	</span><span class="COMM">// (in strict mode, aclv will call addrFoundCallback if it gets a Return)</span><span class="WHIT">
<span class="line">736</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._strictMode</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">13</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">737</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;_keyDownCallback found RETURN&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">738</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._editMode</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._editModeBubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">739</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">bubble.addrObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">740</span> </span><span class="WHIT">			</span><span class="NAME">this._leaveEditMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">741</span> </span><span class="WHIT">			</span><span class="NAME">propagate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">742</span> </span><span class="WHIT">			</span><span class="NAME">clearInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">743</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">744</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">745</span> 
<span class="line">746</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">clearInput</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">AjxEnv.isGeckoBased</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">747</span> </span><span class="WHIT">		</span><span class="NAME">AjxTimedAction.scheduleAction</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AjxTimedAction</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._setInputValue</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">&#34;&#34;</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">20</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">748</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">749</span> </span><span class="WHIT">	
<span class="line">750</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">propagate</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">751</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">752</span> 
<span class="line">753</span> </span><span class="COMM">// need to do this on keyup, after character has appeared in the INPUT</span><span class="WHIT">
<span class="line">754</span> </span><span class="NAME">ZmAddressInputField.prototype._keyUpCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">755</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aclv</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">756</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._input.value</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._editMode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">757</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._bubbleRemovedCallback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">758</span> </span><span class="WHIT">			</span><span class="NAME">this._bubbleRemovedCallback.run</span><span class="PUNC">(</span><span class="NAME">this._editModeBubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">759</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">760</span> </span><span class="WHIT">		</span><span class="NAME">this._leaveEditMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">761</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">762</span> </span><span class="WHIT">	</span><span class="NAME">this._resizeInput</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">763</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">764</span> 
<span class="line">765</span> </span><span class="NAME">ZmAddressInputField.prototype._selectionListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">766</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">767</span> 
<span class="line">768</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ev.item</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">769</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.detail</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONDBLCLICK</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">770</span> </span><span class="WHIT">		</span><span class="COMM">// Double-clicking a bubble moves it into edit mode. It is replaced by the</span><span class="WHIT">
<span class="line">771</span> </span><span class="WHIT">		</span><span class="COMM">// INPUT, which is moved to the bubble&#39;s position. The bubble&#39;s address fills</span><span class="WHIT">
<span class="line">772</span> </span><span class="WHIT">		</span><span class="COMM">// the input and is selected.</span><span class="WHIT">
<span class="line">773</span> </span><span class="WHIT">		</span><span class="NAME">this.setSelected</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">774</span> </span><span class="WHIT">		</span><span class="NAME">this._checkInput</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">775</span> </span><span class="WHIT">		</span><span class="NAME">this._enterEditMode</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">776</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">777</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">778</span> </span><span class="WHIT">		</span><span class="NAME">this._resetOperations</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">779</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">780</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">781</span> 
<span class="line">782</span> </span><span class="NAME">ZmAddressInputField.prototype._actionListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">783</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">784</span> 
<span class="line">785</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ev.item</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">786</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">menu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getActionMenu</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">787</span> </span><span class="WHIT">	</span><span class="NAME">ZmAddressInputField.menuContext.addrInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">788</span> </span><span class="WHIT">	</span><span class="NAME">ZmAddressInputField.menuContext.event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">789</span> </span><span class="WHIT">	</span><span class="NAME">ZmAddressInputField.menuContext.bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">790</span> 
<span class="line">791</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;right sel bubble: &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">bubble.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">792</span> </span><span class="WHIT">	</span><span class="NAME">this._resetOperations</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">793</span> 
<span class="line">794</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">email</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble.email</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">795</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contactsApp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">appCtxt.getApp</span><span class="PUNC">(</span><span class="NAME">ZmApp.CONTACTS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">796</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">email</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">contactsApp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">797</span> </span><span class="WHIT">		</span><span class="COMM">// first check if contact is cached, and no server call is needed</span><span class="WHIT">
<span class="line">798</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contact</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contactsApp.getContactByEmail</span><span class="PUNC">(</span><span class="NAME">email</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">799</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contact</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">800</span> </span><span class="WHIT">			</span><span class="NAME">this._handleResponseGetContact</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">contact</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">801</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">802</span> </span><span class="WHIT">			</span><span class="NAME">menu.getOp</span><span class="PUNC">(</span><span class="NAME">ZmOperation.CONTACT</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setText</span><span class="PUNC">(</span><span class="NAME">ZmMsg.loading</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">803</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">respCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._handleResponseGetContact.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">804</span> </span><span class="WHIT">			</span><span class="NAME">contactsApp.getContactByEmail</span><span class="PUNC">(</span><span class="NAME">email</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">respCallback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">805</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">806</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">807</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">808</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">actionMenu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getActionMenu</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">809</span> </span><span class="WHIT">		</span><span class="NAME">actionMenu.getOp</span><span class="PUNC">(</span><span class="NAME">ZmOperation.CONTACT</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setVisible</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">810</span> </span><span class="WHIT">		</span><span class="NAME">actionMenu.getOp</span><span class="PUNC">(</span><span class="NAME">ZmOperation.EXPAND</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setVisible</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">811</span> 
<span class="line">812</span> </span><span class="WHIT">		</span><span class="NAME">this._setContactText</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">813</span> </span><span class="WHIT">		</span><span class="NAME">menu.popup</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev.docX</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">bubble.getXW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev.docY</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">bubble.getYH</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">814</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">815</span> 
<span class="line">816</span> </span><span class="WHIT">	</span><span class="COMM">// if we are listening for outside mouse clicks, add the action menu to the elements</span><span class="WHIT">
<span class="line">817</span> </span><span class="WHIT">	</span><span class="COMM">// defined as &#34;inside&#34; so that clicking a menu item doesn&#39;t call our outside listener</span><span class="WHIT">
<span class="line">818</span> </span><span class="WHIT">	</span><span class="COMM">// and deselectAll before the menu listener does its thing</span><span class="WHIT">
<span class="line">819</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._noOutsideListening</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getSelectionCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&gt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">820</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">omem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">appCtxt.getOutsideMouseEventMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">821</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">omemParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">822</span> </span><span class="WHIT">			</span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT">					</span><span class="STRN">&#34;ZmAddressBubbleList&#34;</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">823</span> </span><span class="WHIT">			</span><span class="NAME">obj</span><span class="PUNC">:</span><span class="WHIT">				</span><span class="NAME">menu</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">824</span> </span><span class="WHIT">			</span><span class="NAME">outsideListener</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">this.getOutsideListener</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class="line">825</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">826</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;ADD menu to outside listening &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this._input.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">827</span> </span><span class="WHIT">		</span><span class="NAME">omem.startListening</span><span class="PUNC">(</span><span class="NAME">omemParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">828</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">829</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">830</span> 
<span class="line">831</span> </span><span class="NAME">ZmAddressInputField.prototype.getOutsideListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">832</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">833</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._bubbleList</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this._bubbleList._outsideMouseListener.bind</span><span class="PUNC">(</span><span class="NAME">this._bubbleList</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">834</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">835</span> 
<span class="line">836</span> </span><span class="NAME">ZmAddressInputField.prototype.getActionMenu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">837</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">838</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">menu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._actionMenu</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.parent._bubbleActionMenu</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">839</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">menu</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">840</span> </span><span class="WHIT">		</span><span class="NAME">menu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._actionMenu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.parent._bubbleActionMenu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._createActionMenu</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">841</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">842</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">menu</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">843</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">844</span> 
<span class="line">845</span> </span><span class="NAME">ZmAddressInputField.prototype._createActionMenu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">846</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">847</span> 
<span class="line">848</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;create action menu for &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this._input.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">849</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">menuItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getActionMenuOps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">850</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">menu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ZmActionMenu</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">parent</span><span class="PUNC">:</span><span class="NAME">this.shell</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">menuItems</span><span class="PUNC">:</span><span class="NAME">menuItems</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">851</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">menuItems.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">852</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">menuItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">menuItems</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">853</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">menuItem</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">854</span> </span><span class="WHIT">			</span><span class="NAME">menu.addSelectionListener</span><span class="PUNC">(</span><span class="NAME">menuItem</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">menuItem</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">855</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">856</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">857</span> </span><span class="WHIT">	</span><span class="NAME">menu.addPopupListener</span><span class="PUNC">(</span><span class="NAME">this._menuPopupListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">858</span> </span><span class="WHIT">	</span><span class="NAME">menu.addPopdownListener</span><span class="PUNC">(</span><span class="NAME">this._menuPopdownListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">859</span> 
<span class="line">860</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._bubbleMenuCreatedCallback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">861</span> </span><span class="WHIT">		</span><span class="NAME">this._bubbleMenuCreatedCallback.run</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">menu</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">862</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">863</span> 
<span class="line">864</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">menu</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">865</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">866</span> 
<span class="line">867</span> </span><span class="NAME">ZmAddressInputField.prototype._resetOperations</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">868</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">869</span> 
<span class="line">870</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">menu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getActionMenu</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">871</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">menu</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">872</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">873</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">874</span> </span><span class="WHIT">		</span><span class="NAME">menu.enable</span><span class="PUNC">(</span><span class="NAME">ZmOperation.DELETE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sel.length</span><span class="WHIT"> </span><span class="PUNC">&gt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">875</span> </span><span class="WHIT">		</span><span class="NAME">menu.enable</span><span class="PUNC">(</span><span class="NAME">ZmOperation.COPY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sel.length</span><span class="WHIT"> </span><span class="PUNC">&gt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">876</span> </span><span class="WHIT">		</span><span class="NAME">menu.enable</span><span class="PUNC">(</span><span class="NAME">ZmOperation.EDIT</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Boolean</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">877</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">email</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">bubble.email</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">878</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ac</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.parentAppCtxt</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">window.appCtxt</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">879</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isExpandableDl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ac.isExpandableDL</span><span class="PUNC">(</span><span class="NAME">email</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">880</span> </span><span class="WHIT">		</span><span class="NAME">menu.enable</span><span class="PUNC">(</span><span class="NAME">ZmOperation.EXPAND</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isExpandableDl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">881</span> </span><span class="WHIT">		</span><span class="COMM">//not sure this is %100 good, since isExpandableDL returns false also if EXPAND_DL_ENABLED setting is false.</span><span class="WHIT">
<span class="line">882</span> </span><span class="WHIT">		</span><span class="COMM">//but I tried to do this in _setContactText by passing in the contact we get (using getContactByEmail) - but that contact somehow doesn&#39;t</span><span class="WHIT">
<span class="line">883</span> </span><span class="WHIT">		</span><span class="COMM">//have isGal set or type &#34;group&#34; (the type is &#34;contact&#34;), thus isDistributionList returns null. Not sure what this inconsistency comes from.</span><span class="WHIT">
<span class="line">884</span> 
<span class="line">885</span> </span><span class="WHIT">		</span><span class="COMM">//so this is messy and I just try to do the best with information - see the comment above - so I use isExpandableDl as indication of DL (sometimes it&#39;s false despite it being an expandable DL)</span><span class="WHIT">
<span class="line">886</span> </span><span class="WHIT">		</span><span class="COMM">//and I also use isDL as another way to try to know if it&#39;s a DL (by trying to find the contact from the contactsApp cache - sometimes it&#39;s there, sometimes not (it&#39;s there</span><span class="WHIT">
<span class="line">887</span> </span><span class="WHIT">		</span><span class="COMM">//after you go to the DL folder).</span><span class="WHIT">
<span class="line">888</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contactsApp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">appCtxt.getApp</span><span class="PUNC">(</span><span class="NAME">ZmApp.CONTACTS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">889</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contact</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contactsApp</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">contactsApp.getContactByEmail</span><span class="PUNC">(</span><span class="NAME">email</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">890</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isDL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contact</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">contact.isDistributionList</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">891</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">isDL</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isExpandableDl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contact</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">contact.dlInfo</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">contact.dlInfo.isOwner</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">892</span> </span><span class="WHIT">		</span><span class="NAME">menu.enable</span><span class="PUNC">(</span><span class="NAME">ZmOperation.CONTACT</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">canEdit</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">893</span> 
<span class="line">894</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">895</span> 
<span class="line">896</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._bubbleResetOperationsCallback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">897</span> </span><span class="WHIT">		</span><span class="NAME">this._bubbleResetOperationsCallback.run</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">menu</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">898</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">899</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">900</span> 
<span class="line">901</span> </span><span class="NAME">ZmAddressInputField.prototype._getActionMenuOps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">902</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">903</span> 
<span class="line">904</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ops</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">ZmOperation.DELETE</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">905</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AjxClipboard.isSupported</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">906</span> </span><span class="WHIT">		</span><span class="COMM">// we use Zero Clipboard (a Flash hack) to copy address</span><span class="WHIT">
<span class="line">907</span> </span><span class="WHIT">		</span><span class="NAME">ops.push</span><span class="PUNC">(</span><span class="NAME">ZmOperation.COPY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">908</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">909</span> </span><span class="WHIT">	</span><span class="NAME">ops.push</span><span class="PUNC">(</span><span class="NAME">ZmOperation.EDIT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">910</span> </span><span class="WHIT">	</span><span class="NAME">ops.push</span><span class="PUNC">(</span><span class="NAME">ZmOperation.EXPAND</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">911</span> </span><span class="WHIT">	</span><span class="NAME">ops.push</span><span class="PUNC">(</span><span class="NAME">ZmOperation.CONTACT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">912</span> </span><span class="WHIT">	
<span class="line">913</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ops</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">914</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">915</span> 
<span class="line">916</span> </span><span class="NAME">ZmAddressInputField.prototype._handleResponseGetContact</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">917</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">contact</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">918</span> </span><span class="WHIT">	</span><span class="NAME">ZmAddressInputField.menuContext.contact</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contact</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">919</span> </span><span class="WHIT">	</span><span class="NAME">this._setContactText</span><span class="PUNC">(</span><span class="NAME">contact</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">920</span> </span><span class="WHIT">	</span><span class="NAME">this.getActionMenu</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">popup</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev.docX</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ev.item.getXW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">921</span> </span><span class="WHIT">	                           </span><span class="NAME">ev.docY</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ev.item.getYH</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">922</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">923</span> 
<span class="line">924</span> </span><span class="NAME">ZmAddressInputField.prototype._setContactText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">925</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">contact</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">926</span> </span><span class="WHIT">	</span><span class="NAME">ZmBaseController.setContactTextOnMenu</span><span class="PUNC">(</span><span class="NAME">contact</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getActionMenu</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">927</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">928</span> 
<span class="line">929</span> </span><span class="NAME">ZmAddressInputField.prototype._deleteListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">930</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">931</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.menuContext.addrInput</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">932</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">addrInput.getSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">933</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">sel.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">934</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sel.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">935</span> </span><span class="WHIT">			</span><span class="NAME">addrInput.removeBubble</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">936</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">937</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">938</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">939</span> 
<span class="line">940</span> </span><span class="NAME">ZmAddressInputField.prototype._editListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">941</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">942</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.menuContext.addrInput</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">943</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.menuContext.bubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">944</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">945</span> </span><span class="WHIT">		</span><span class="NAME">addrInput._enterEditMode</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">946</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">947</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">948</span> 
<span class="line">949</span> </span><span class="NAME">ZmAddressInputField.prototype._expandListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">950</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">951</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.menuContext.addrInput</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">952</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.menuContext.bubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">953</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">954</span> </span><span class="WHIT">		</span><span class="NAME">ZmAddressBubble.expandBubble</span><span class="PUNC">(</span><span class="NAME">bubble.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bubble.email</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">955</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">956</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">957</span> 
<span class="line">958</span> </span><span class="COMM">/**
<span class="line">959</span>  * If there&#39;s a contact for the participant, edit it, otherwise add it.
<span class="line">960</span>  *
<span class="line">961</span>  * @private
<span class="line">962</span>  */</span><span class="WHIT">
<span class="line">963</span> </span><span class="NAME">ZmAddressInputField.prototype._contactListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">964</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">965</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.menuContext.addrInput</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">966</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">addrInput</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">967</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">loadCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addrInput._handleLoadContactListener.bind</span><span class="PUNC">(</span><span class="NAME">addrInput</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">968</span> </span><span class="WHIT">		</span><span class="NAME">AjxDispatcher.require</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">&#34;ContactsCore&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;Contacts&#34;</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loadCallback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">969</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">970</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">971</span> 
<span class="line">972</span> </span><span class="COMM">/**
<span class="line">973</span>  * @private
<span class="line">974</span>  */</span><span class="WHIT">
<span class="line">975</span> </span><span class="NAME">ZmAddressInputField.prototype._handleLoadContactListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">976</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">977</span> 
<span class="line">978</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctlr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.parentAppCtxt</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">window.parentAppCtxt.getApp</span><span class="PUNC">(</span><span class="NAME">ZmApp.CONTACTS</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getContactController</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class="line">979</span> </span><span class="WHIT">									  </span><span class="NAME">AjxDispatcher.run</span><span class="PUNC">(</span><span class="STRN">&#34;GetContactController&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">980</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contact</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.menuContext.contact</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">981</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contact</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">982</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contact.isLoaded</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">983</span> </span><span class="WHIT">			</span><span class="NAME">ctlr.show</span><span class="PUNC">(</span><span class="NAME">contact</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">984</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">985</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._loadContactCallback.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">986</span> </span><span class="WHIT">			</span><span class="NAME">contact.load</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">987</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">988</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">989</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contact</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ZmContact</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">990</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.menuContext.bubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">991</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">email</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">bubble.email</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">992</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">email</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">993</span> </span><span class="WHIT">			</span><span class="NAME">contact.initFromEmail</span><span class="PUNC">(</span><span class="NAME">email</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">994</span> </span><span class="WHIT">			</span><span class="NAME">ctlr.show</span><span class="PUNC">(</span><span class="NAME">contact</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">995</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">996</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">997</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">998</span> 
<span class="line">999</span> </span><span class="NAME">ZmAddressInputField.prototype._loadContactCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1000</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">resp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">contact</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1001</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctlr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.parentAppCtxt</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">window.parentAppCtxt.getApp</span><span class="PUNC">(</span><span class="NAME">ZmApp.CONTACTS</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getContactController</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class="line">1002</span> </span><span class="WHIT">									  </span><span class="NAME">AjxDispatcher.run</span><span class="PUNC">(</span><span class="STRN">&#34;GetContactController&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1003</span> </span><span class="WHIT">	</span><span class="NAME">ctlr.show</span><span class="PUNC">(</span><span class="NAME">contact</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1004</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1005</span> 
<span class="line">1006</span> </span><span class="COMM">// Sets up our use of the clipboard to copy address via a menu item</span><span class="WHIT">
<span class="line">1007</span> </span><span class="NAME">ZmAddressInputField.prototype._menuPopupListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1008</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1009</span> 
<span class="line">1010</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clipboard</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">appCtxt.getClipboard</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1011</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">clipboard</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1012</span> </span><span class="WHIT">		</span><span class="NAME">clipboard.addClient</span><span class="PUNC">(</span><span class="STRN">&#39;ZmAddressInputField&#39;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._actionMenu.getOp</span><span class="PUNC">(</span><span class="NAME">ZmOperation.COPY</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1013</span> </span><span class="WHIT">			</span><span class="NAME">onMouseDown</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="NAME">this._clipCopy.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">1014</span> </span><span class="WHIT">			</span><span class="NAME">onComplete</span><span class="PUNC">:</span><span class="WHIT">     </span><span class="NAME">this._clipCopyComplete.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT">
<span class="line">1015</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1016</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1017</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1018</span> 
<span class="line">1019</span> </span><span class="COMM">// Copies address text from the active bubble to the clipboard.</span><span class="WHIT">
<span class="line">1020</span> </span><span class="NAME">ZmAddressInputField.prototype._clipCopy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1021</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">clip</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1022</span> </span><span class="WHIT">	</span><span class="NAME">clip.setText</span><span class="PUNC">(</span><span class="NAME">ZmAddressInputField.menuContext.bubble.address</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this._separator</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1023</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1024</span> 
<span class="line">1025</span> </span><span class="NAME">ZmAddressInputField.prototype._clipCopyComplete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1026</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">clip</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1027</span> </span><span class="WHIT">	</span><span class="NAME">this._actionMenu.popdown</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1028</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1029</span> 
<span class="line">1030</span> </span><span class="NAME">ZmAddressInputField.prototype._menuPopdownListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1031</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1032</span> 
<span class="line">1033</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.menuContext.bubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1034</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1035</span> </span><span class="WHIT">		</span><span class="NAME">bubble.setClassName</span><span class="PUNC">(</span><span class="NAME">this._bubbleClassName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1036</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1037</span> 
<span class="line">1038</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._noOutsideListening</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getSelectionCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&gt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1039</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;REMOVE menu from outside listening &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this._input.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1040</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">omem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">appCtxt.getOutsideMouseEventMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1041</span> </span><span class="WHIT">		</span><span class="NAME">omem.stopListening</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="STRN">&#34;ZmAddressInputField&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">:</span><span class="NAME">this.getActionMenu</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1042</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1043</span> 
<span class="line">1044</span> </span><span class="WHIT">	</span><span class="COMM">// use a timer since popdown happens before listeners are called; alternatively, we could put the</span><span class="WHIT">
<span class="line">1045</span> </span><span class="WHIT">	</span><span class="COMM">// code below at the end of every menu action listener</span><span class="WHIT">
<span class="line">1046</span> </span><span class="WHIT">	</span><span class="NAME">AjxTimedAction.scheduleAction</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AjxTimedAction</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">1047</span> </span><span class="WHIT">		</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1048</span> </span><span class="WHIT">			</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;_menuPopdownListener&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1049</span> </span><span class="WHIT">			</span><span class="NAME">ZmAddressInputField.menuContext</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1050</span> </span><span class="WHIT">			</span><span class="NAME">this._bubbleList.clearRightSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1051</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1052</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1053</span> 
<span class="line">1054</span> </span><span class="NAME">ZmAddressInputField.prototype._enterEditMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1055</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1056</span> 
<span class="line">1057</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;ENTER edit mode&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1058</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._editMode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1059</span> </span><span class="WHIT">		</span><span class="COMM">// user double-clicked a bubble while another bubble was being edited</span><span class="WHIT">
<span class="line">1060</span> </span><span class="WHIT">		</span><span class="NAME">this._leaveEditMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1061</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1062</span> 
<span class="line">1063</span> </span><span class="WHIT">	</span><span class="NAME">this._editMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1064</span> </span><span class="WHIT">	</span><span class="NAME">this._editModeIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getBubbleIndex</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1065</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;MOVE input&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1066</span> </span><span class="WHIT">	</span><span class="NAME">this._holder.insertBefore</span><span class="PUNC">(</span><span class="NAME">this._input</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bubble.getHtmlElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1067</span> </span><span class="WHIT">	</span><span class="NAME">this.removeBubble</span><span class="PUNC">(</span><span class="NAME">bubble.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1068</span> 
<span class="line">1069</span> </span><span class="WHIT">	</span><span class="NAME">this._editModeBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1070</span> </span><span class="WHIT">	</span><span class="NAME">this._setInputValue</span><span class="PUNC">(</span><span class="NAME">bubble.address</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1071</span> 
<span class="line">1072</span> </span><span class="WHIT">	</span><span class="COMM">// Chrome triggers BLUR after DBLCLICK, so use a timer to make sure select works</span><span class="WHIT">
<span class="line">1073</span> </span><span class="WHIT">	</span><span class="NAME">AjxTimedAction.scheduleAction</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AjxTimedAction</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">1074</span> </span><span class="WHIT">		</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1075</span> </span><span class="WHIT">			</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1076</span> </span><span class="WHIT">			</span><span class="NAME">this._input.select</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1077</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">20</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1078</span> 
<span class="line">1079</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._singleBubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1080</span> </span><span class="WHIT">		</span><span class="NAME">this._setInputEnabled</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1081</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1082</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1083</span> 
<span class="line">1084</span> </span><span class="NAME">ZmAddressInputField.prototype._leaveEditMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1085</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">restore</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1086</span> 
<span class="line">1087</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;LEAVE edit mode&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1088</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._editMode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1089</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1090</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1091</span> 
<span class="line">1092</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._holder.lastChild</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this._input</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1093</span> </span><span class="WHIT">		</span><span class="NAME">this._holder.appendChild</span><span class="PUNC">(</span><span class="NAME">this._input</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1094</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1095</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">restore</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._editModeBubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1096</span> </span><span class="WHIT">	</span><span class="NAME">this._checkInput</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">bubble.address</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1097</span> </span><span class="WHIT">	</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1098</span> 
<span class="line">1099</span> </span><span class="WHIT">	</span><span class="NAME">this._editMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1100</span> </span><span class="WHIT">	</span><span class="NAME">this._editModeIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._editModeBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1101</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;input value: &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">AjxStringUtil.htmlEncode</span><span class="PUNC">(</span><span class="NAME">this._input.value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1102</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1103</span> 
<span class="line">1104</span> </span><span class="COMM">// size the input to a bit more than its current content</span><span class="WHIT">
<span class="line">1105</span> </span><span class="NAME">ZmAddressInputField.prototype._resizeInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1106</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1107</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxStringUtil.htmlEncode</span><span class="PUNC">(</span><span class="NAME">this._input.value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1108</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">paddings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Dwt.getMargins</span><span class="PUNC">(</span><span class="NAME">this._holder</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1109</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">margins</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Dwt.getMargins</span><span class="PUNC">(</span><span class="NAME">this._input</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1110</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Dwt.getSize</span><span class="PUNC">(</span><span class="NAME">this._holder</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._input.offsetLeft</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">AjxEnv.isTrident</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">margins.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">paddings.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">paddings.right</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">margins.right</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1111</span> </span><span class="WHIT">	</span><span class="NAME">maxWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">maxWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//don&#39;t get too small - minimum 3 - if it gets negative, the cursor would not show up before starting to type (bug 84924)</span><span class="WHIT">
<span class="line">1112</span> 
<span class="line">1113</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;100%&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1114</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._input.supportsAutoComplete</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1115</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputFontSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtCssStyle.getProperty</span><span class="PUNC">(</span><span class="NAME">this._input</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;font-size&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1116</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxStringUtil.getWidth</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inputFontSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1117</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AjxEnv.isWindows</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AjxEnv.isFirefox</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">AjxEnv.isSafari</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">AjxEnv.isChrome</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1118</span> </span><span class="WHIT">			</span><span class="COMM">// FF/Win: fudge factor since string is longer in INPUT than when measured in SPAN</span><span class="WHIT">
<span class="line">1119</span> </span><span class="WHIT">			</span><span class="NAME">strW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">strW</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1.2</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1120</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1121</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pad</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._editMode</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.INPUT_EXTRA_SMALL</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.INPUT_EXTRA</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1122</span> </span><span class="WHIT">		</span><span class="NAME">inputWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">strW</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">pad</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxWidth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1123</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._editMode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1124</span> </span><span class="WHIT">			</span><span class="NAME">inputWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">inputWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.INPUT_EXTRA</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1125</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1126</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1127</span> </span><span class="WHIT">	</span><span class="NAME">Dwt.setSize</span><span class="PUNC">(</span><span class="NAME">this._input</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inputWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Dwt.DEFAULT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1128</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1129</span> 
<span class="line">1130</span> </span><span class="NAME">ZmAddressInputField.prototype.hasFocus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1131</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1132</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1133</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1134</span> 
<span class="line">1135</span> </span><span class="NAME">ZmAddressInputField.prototype.getKeyMapName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1136</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1137</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ZmKeyMap.MAP_ADDRESS</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1138</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1139</span> 
<span class="line">1140</span> </span><span class="COMM">// invoked when at least one bubble is selected</span><span class="WHIT">
<span class="line">1141</span> </span><span class="NAME">ZmAddressInputField.prototype.handleKeyAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1142</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">actionCode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1143</span> 
<span class="line">1144</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSelectionCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1145</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selCount</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1146</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1147</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1148</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;handle shortcut: &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">actionCode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1149</span> </span><span class="WHIT">	
<span class="line">1150</span> 	</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">actionCode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1151</span> 
<span class="line">1152</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">DwtKeyMap.DELETE</span><span class="PUNC">:</span><span class="WHIT">
<span class="line">1153</span> </span><span class="WHIT">			</span><span class="NAME">this.handleDelete</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1154</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1155</span> 
<span class="line">1156</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">DwtKeyMap.SELECT_NEXT</span><span class="PUNC">:</span><span class="WHIT">
<span class="line">1157</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selCount</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1158</span> </span><span class="WHIT">				</span><span class="NAME">this._selectAdjacentBubble</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1159</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1160</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1161</span> 
<span class="line">1162</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">DwtKeyMap.SELECT_PREV</span><span class="PUNC">:</span><span class="WHIT">
<span class="line">1163</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selCount</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1164</span> </span><span class="WHIT">				</span><span class="NAME">this._selectAdjacentBubble</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1165</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1166</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1167</span> 
<span class="line">1168</span> </span><span class="WHIT">		</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class="line">1169</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1170</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1171</span> 
<span class="line">1172</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1173</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1174</span> 
<span class="line">1175</span> </span><span class="COMM">// Returns an ordered list of bubbles</span><span class="WHIT">
<span class="line">1176</span> </span><span class="NAME">ZmAddressInputField.prototype._getBubbleList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1177</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1178</span> 
<span class="line">1179</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">list</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1180</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">children</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._holder.childNodes</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1181</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">children.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1182</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1183</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._bubble</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1184</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtControl.fromElementId</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1185</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1186</span> </span><span class="WHIT">				</span><span class="NAME">list.push</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1187</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1188</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1189</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1190</span> </span><span class="WHIT">	
<span class="line">1191</span> 	</span><span class="NAME">this._bubbleList.set</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1192</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._bubbleList</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1193</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1194</span> 
<span class="line">1195</span> </span><span class="NAME">ZmAddressInputField.prototype.getBubbleCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1196</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1197</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._getBubbleList</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getArray</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1198</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1199</span> 
<span class="line">1200</span> </span><span class="COMM">// returns the index of the given bubble among all the holder&#39;s elements (not just bubbles)</span><span class="WHIT">
<span class="line">1201</span> </span><span class="NAME">ZmAddressInputField.prototype._getBubbleIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1202</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1203</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">AjxUtil.indexOf</span><span class="PUNC">(</span><span class="NAME">this._holder.childNodes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bubble.getHtmlElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1204</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1205</span> 
<span class="line">1206</span> </span><span class="COMM">// returns the index of the INPUT among all the holder&#39;s elements</span><span class="WHIT">
<span class="line">1207</span> </span><span class="NAME">ZmAddressInputField.prototype._getInputIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1208</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1209</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">AjxUtil.indexOf</span><span class="PUNC">(</span><span class="NAME">this._holder.childNodes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._input</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1210</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1211</span> 
<span class="line">1212</span> </span><span class="COMM">/**
<span class="line">1213</span>  * Selects the next or previous bubble relative to the selected one.
<span class="line">1214</span>  *
<span class="line">1215</span>  * @param {boolean}			next		if true, select next bubble; otherwise select previous bubble
<span class="line">1216</span>  */</span><span class="WHIT">
<span class="line">1217</span> </span><span class="NAME">ZmAddressInputField.prototype._selectAdjacentBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1218</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">next</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1219</span> 
<span class="line">1220</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1221</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">sel.length</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1222</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1223</span> 
<span class="line">1224</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getBubbleIndex</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1225</span> </span><span class="WHIT">	</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">next</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1226</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">children</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._holder.childNodes</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1227</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&gt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">children.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1228</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this._dragInsertionBar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1229</span> </span><span class="WHIT">		</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">next</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1230</span> </span><span class="WHIT">		</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&gt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">children.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1231</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1232</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1233</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this._input</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1234</span> </span><span class="WHIT">			</span><span class="NAME">this.setSelected</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1235</span> </span><span class="WHIT">			</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1236</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1237</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1238</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtControl.fromElement</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1239</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newBubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1240</span> </span><span class="WHIT">				</span><span class="NAME">this.setSelected</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1241</span> </span><span class="WHIT">				</span><span class="NAME">this.setSelected</span><span class="PUNC">(</span><span class="NAME">newBubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1242</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1243</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1244</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1245</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1246</span> 
<span class="line">1247</span> </span><span class="COMM">/**
<span class="line">1248</span>  * Returns an ordered list of bubble addresses.
<span class="line">1249</span>  *
<span class="line">1250</span>  * @param {boolean}	asObjects	if true, return list of AjxEmailAddress
<span class="line">1251</span>  */</span><span class="WHIT">
<span class="line">1252</span> </span><span class="NAME">ZmAddressInputField.prototype.getAddresses</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1253</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">asObjects</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1254</span> 
<span class="line">1255</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1256</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubbles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getBubbleList</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getArray</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1257</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ac</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.parentAppCtxt</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">window.appCtxt</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1258</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">bubbles.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1259</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubbles</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1260</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble.address</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1261</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">asObjects</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1262</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxEmailAddress.parse</span><span class="PUNC">(</span><span class="NAME">addr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AjxEmailAddress</span><span class="PUNC">(</span><span class="STRN">&#34;&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">addr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1263</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ac.isExpandableDL</span><span class="PUNC">(</span><span class="NAME">bubble.email</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bubble.match</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">bubble.match.isDL</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1264</span> </span><span class="WHIT">				</span><span class="NAME">addrObj.isGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1265</span> </span><span class="WHIT">				</span><span class="NAME">addrObj.canExpand</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1266</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1267</span> </span><span class="WHIT">			</span><span class="NAME">addrs.push</span><span class="PUNC">(</span><span class="NAME">addrObj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1268</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1269</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1270</span> </span><span class="WHIT">			</span><span class="NAME">addrs.push</span><span class="PUNC">(</span><span class="NAME">addr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1271</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1272</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1273</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">addrs</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1274</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1275</span> 
<span class="line">1276</span> </span><span class="NAME">ZmAddressInputField._getAddrInputFromEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1277</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1278</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtUiEvent.getTarget</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1279</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">DwtControl.ALL_BY_ID</span><span class="PUNC">[</span><span class="NAME">target._aifId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1280</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1281</span> 
<span class="line">1282</span> </span><span class="COMM">/**
<span class="line">1283</span>  * Since both the input and each of its bubbles has a drop listener, the target object may be
<span class="line">1284</span>  * either of those object types. Dropping is okay if we&#39;re over a different type of input, or if
<span class="line">1285</span>  * we&#39;re reordering bubbles within the same input.
<span class="line">1286</span>  */</span><span class="WHIT">
<span class="line">1287</span> </span><span class="NAME">ZmAddressInputField.prototype._dropListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1288</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dragEv</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1289</span> 
<span class="line">1290</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragEv.srcData</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">dragEv.srcData.selection</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1291</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">sel.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1292</span> 
<span class="line">1293</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dragEv.action</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtDropEvent.DRAG_ENTER</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1294</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;DRAG_ENTER&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1295</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragEv.uiEvent.dwtObj</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1296</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetObj.isAddressBubble</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">targetObj.addrInput</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">targetObj</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1297</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dragBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1298</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dragBubble.type</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1299</span> </span><span class="WHIT">			</span><span class="NAME">dragEv.doIt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1300</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1301</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetInput._numBubbles</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1302</span> </span><span class="WHIT">			</span><span class="NAME">dragEv.doIt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1303</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1304</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dragEv.doIt</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">targetInput._numBubbles</span><span class="WHIT"> </span><span class="PUNC">&gt;=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1305</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetInput._getIndexFromEvent</span><span class="PUNC">(</span><span class="NAME">dragEv.uiEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1306</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubbleIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetInput._getBubbleIndex</span><span class="PUNC">(</span><span class="NAME">dragBubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1307</span> </span><span class="WHIT">			</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;idx: &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;, bubbleIdx: &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">bubbleIdx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1308</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">dragBubble.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">bubbleIdx</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">bubbleIdx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1309</span> </span><span class="WHIT">				</span><span class="NAME">dragEv.doIt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1310</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1311</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1312</span> </span><span class="WHIT">				</span><span class="NAME">this._setInsertionBar</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1313</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1314</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1315</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">dragEv.doIt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1316</span> </span><span class="WHIT">			</span><span class="NAME">this._setInsertionBar</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1317</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1318</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1319</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dragEv.action</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtDropEvent.DRAG_LEAVE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1320</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;DRAG_LEAVE&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1321</span> </span><span class="WHIT">		</span><span class="NAME">this._setInsertionBar</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1322</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1323</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dragEv.action</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtDropEvent.DRAG_DROP</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1324</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;DRAG_DROP&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1325</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragEv.srcData.addrInput</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1326</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getInsertionIndex</span><span class="PUNC">(</span><span class="NAME">this._dragInsertionBar</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1327</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sel.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1328</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1329</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble.id</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1330</span> </span><span class="WHIT">			</span><span class="NAME">this.addBubble</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">bubble</span><span class="PUNC">:</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">:</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1331</span> </span><span class="WHIT">			</span><span class="NAME">sourceInput.removeBubble</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1332</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1333</span> </span><span class="WHIT">		</span><span class="NAME">this._setInsertionBar</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1334</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1335</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1336</span> 
<span class="line">1337</span> </span><span class="NAME">ZmAddressInputField.prototype._dragBoxListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1338</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1339</span> </span><span class="WHIT">    </span><span class="COMM">// Check if user is using scroll bar rather than trying to drag.</span><span class="WHIT">
<span class="line">1340</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">ev.srcControl</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._holder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1341</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._holder.scrollWidth</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">//returns width w/out scrollbar</span><span class="WHIT">
<span class="line">1342</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scrollWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Dwt.getLocation</span><span class="PUNC">(</span><span class="NAME">this._holder</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1343</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dBox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ev.srcControl.getDragBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1344</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dBox</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1345</span> </span><span class="WHIT">            </span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;DRAG_BOX x =&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dBox.getStartX</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34; scrollWidth = &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">scrollWidth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1346</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dBox.getStartX</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&gt;</span><span class="WHIT"> </span><span class="NAME">scrollPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1347</span> </span><span class="WHIT">                </span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;DRAG_BOX x =&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dBox.getStartX</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34; scrollPos = &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">scrollPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1348</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1349</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1350</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1351</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1352</span> 
<span class="line">1353</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.action</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtDragEvent.DRAG_INIT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1354</span> </span><span class="WHIT">		</span><span class="COMM">// okay to draw drag box if we have at least one bubble, and user isn&#39;t clicking in</span><span class="WHIT">
<span class="line">1355</span> </span><span class="WHIT">		</span><span class="COMM">// the non-empty INPUT (might be trying to select text)</span><span class="WHIT">
<span class="line">1356</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._numBubbles</span><span class="WHIT"> </span><span class="PUNC">&gt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.target</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this._input</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._input.value</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">&#34;&#34;</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1357</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1358</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.action</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtDragEvent.DRAG_START</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1359</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;ZmAddressInputField DRAG_START&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1360</span> </span><span class="WHIT">		</span><span class="NAME">this.deselectAll</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1361</span> </span><span class="WHIT">		</span><span class="NAME">this.blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1362</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1363</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.action</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtDragEvent.DRAG_MOVE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1364</span> </span><span class="COMM">//		DBG.println(&#34;aif&#34;, &#34;ZmAddressInputField DRAG_MOVE&#34;);</span><span class="WHIT">
<span class="line">1365</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">box</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._dragSelectionBox</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1366</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1367</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._bubble</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1368</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">span</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble.getHtmlElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1369</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Dwt.doOverlap</span><span class="PUNC">(</span><span class="NAME">box</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">span</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1370</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this._bubbleList.isSelected</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1371</span> </span><span class="WHIT">				</span><span class="NAME">this.setSelected</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1372</span> </span><span class="WHIT">				</span><span class="NAME">appCtxt.getKeyboardMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">grabFocus</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1373</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1374</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1375</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1376</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.action</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtDragEvent.DRAG_END</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1377</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;ZmAddressInputField DRAG_END&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1378</span> </span><span class="WHIT">		</span><span class="NAME">this._bubbleList._checkSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1379</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AjxEnv.isWindows</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getSelectionCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1380</span> </span><span class="WHIT">			</span><span class="NAME">this.blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1381</span> </span><span class="WHIT">			</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1382</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1383</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1384</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1385</span> 
<span class="line">1386</span> </span><span class="NAME">ZmAddressInputField.prototype._mouseDownListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1387</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1388</span> </span><span class="WHIT">    </span><span class="COMM">// reset mouse event to propagate event to browser (allows focus on input when clicking on holder click)</span><span class="WHIT">
<span class="line">1389</span> </span><span class="WHIT">    </span><span class="NAME">ev._stopPropagation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1390</span> </span><span class="WHIT">    </span><span class="NAME">ev._returnValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1391</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1392</span> 
<span class="line">1393</span> </span><span class="COMM">// Returns insertion index (among all elements) based on event coordinates</span><span class="WHIT">
<span class="line">1394</span> </span><span class="NAME">ZmAddressInputField.prototype._getIndexFromEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1395</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1396</span> 
<span class="line">1397</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1398</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.dwtObj</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">ev.dwtObj.isAddressBubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">ev.dwtObj</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1399</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1400</span> </span><span class="WHIT">		</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1401</span> </span><span class="WHIT">		</span><span class="NAME">bx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ev.docX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">bubble.getLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1402</span> </span><span class="WHIT">		</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getBubbleIndex</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// TODO: cache?</span><span class="WHIT">
<span class="line">1403</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bx</span><span class="WHIT"> </span><span class="PUNC">&gt;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1404</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1405</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1406</span> </span><span class="WHIT">		</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1407</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">children</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._holder.childNodes</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1408</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">children.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1409</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1410</span> </span><span class="WHIT">			</span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._bubble</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1411</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1412</span> </span><span class="WHIT">				</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1413</span> </span><span class="WHIT">				</span><span class="NAME">bx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ev.docX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">bubble.getLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1414</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1415</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1416</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1417</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1418</span> </span><span class="WHIT">					</span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1419</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1420</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1421</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">children.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1422</span> </span><span class="WHIT">				</span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1423</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1424</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1425</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1426</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1427</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1428</span> 
<span class="line">1429</span> </span><span class="NAME">ZmAddressInputField.prototype._setInsertionBar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1430</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1431</span> 
<span class="line">1432</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this._dragInsertionBarIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1433</span> 
<span class="line">1434</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._dragInsertionBar</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1435</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1436</span> </span><span class="WHIT">		</span><span class="NAME">bar.style.display</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;inline&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1437</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">refElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._holder.childNodes</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1438</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">refElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1439</span> </span><span class="WHIT">			</span><span class="NAME">this._holder.insertBefore</span><span class="PUNC">(</span><span class="NAME">bar</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">refElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1440</span> </span><span class="WHIT">			</span><span class="NAME">this._dragInsertionBarIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1441</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1442</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1443</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1444</span> </span><span class="WHIT">		</span><span class="NAME">bar.style.display</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;none&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1445</span> </span><span class="WHIT">		</span><span class="NAME">this._dragInsertionBarIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1446</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1447</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1448</span> 
<span class="line">1449</span> </span><span class="NAME">ZmAddressInputField.prototype._getInsertionIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1450</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1451</span> 
<span class="line">1452</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubbleIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1453</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">children</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._holder.childNodes</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1454</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">children.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1455</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1456</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1457</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1458</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1459</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._bubble</span><span class="PUNC">[</span><span class="NAME">el.id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1460</span> </span><span class="WHIT">			</span><span class="NAME">bubbleIndex</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1461</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1462</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1463</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">bubbleIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1464</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1465</span> 
<span class="line">1466</span> 
<span class="line">1467</span> 
<span class="line">1468</span> 
<span class="line">1469</span> </span><span class="COMM">/**
<span class="line">1470</span>  * Creates a bubble that contains an email address.
<span class="line">1471</span>  * @constructor
<span class="line">1472</span>  * @class
<span class="line">1473</span>  * This class represents an object that allows various operations to be performed on an
<span class="line">1474</span>  * email address within a compose or display context.
<span class="line">1475</span>  *
<span class="line">1476</span>  * @param {hash}				params		the hash of parameters:
<span class="line">1477</span>  * @param {ZmAddressInputField}	parent		parent control
<span class="line">1478</span>  * @param {string}				id			element ID for the bubble
<span class="line">1479</span>  * @param {string}				className	CSS class for the bubble
<span class="line">1480</span>  * @param {string}				address		email address to display in the bubble
<span class="line">1481</span>  * @param {AjxEmailAddress}		addrObj		email address (alternative form)
<span class="line">1482</span>  * @param {boolean}				canRemove	if true, an x will be provided to remove the address bubble
<span class="line">1483</span>  * @param {boolean}				canExpand	if true, a + will be provided to expand the DL address
<span class="line">1484</span>  * @param {string}				separator	address separator
<span class="line">1485</span>  *
<span class="line">1486</span>  * @extends DwtControl
<span class="line">1487</span>  */</span><span class="WHIT">
<span class="line">1488</span> </span><span class="NAME">ZmAddressBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1489</span> 
<span class="line">1490</span> </span><span class="WHIT">	</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1491</span> </span><span class="WHIT">	</span><span class="NAME">params.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.id</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">Dwt.getNextId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1492</span> </span><span class="WHIT">	</span><span class="NAME">params.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.className</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">&#34;addrBubble&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1493</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.addClass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1494</span> </span><span class="WHIT">		</span><span class="NAME">params.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">params.className</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.addClass</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">&#34; &#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1495</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1496</span> </span><span class="WHIT">	</span><span class="NAME">DwtControl.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1497</span> 
<span class="line">1498</span> </span><span class="WHIT">	</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.type</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1499</span> </span><span class="WHIT">	</span><span class="NAME">this.isAddressBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1500</span> 
<span class="line">1501</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.addrInput</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.addrInput</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1502</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">match</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.match</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.match</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1503</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">params.noParse</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.address</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">match</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">match.email</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1504</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.addrObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.addrObj</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">addrContent</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">AjxEmailAddress.parse</span><span class="PUNC">(</span><span class="NAME">addrContent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1505</span> </span><span class="WHIT">	</span><span class="NAME">this.address</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.address</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">addrObj</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">addrObj.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1506</span> </span><span class="WHIT">	</span><span class="NAME">this.email</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.email</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.email</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">addrObj</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">addrObj.getAddress</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">&#34;&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1507</span> </span><span class="WHIT">	</span><span class="COMM">// text search bubbles won&#39;t have anything in the &#34;email&#34; field so we need to use &#34;address&#34; for hash lookup</span><span class="WHIT">
<span class="line">1508</span> </span><span class="WHIT">	</span><span class="NAME">this.hashKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ZmId.SEARCH</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.address</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.email</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1509</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ac</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.parentAppCtxt</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">window.appCtxt</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1510</span> </span><span class="WHIT">	</span><span class="NAME">this.canExpand</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.canExpand</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.canExpand</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ac.isExpandableDL</span><span class="PUNC">(</span><span class="NAME">this.email</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1511</span> </span><span class="WHIT">	
<span class="line">1512</span> 	</span><span class="NAME">this._createHtml</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1513</span> 
<span class="line">1514</span> </span><span class="WHIT">	</span><span class="NAME">this._setEventHdlrs</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">DwtEvent.ONCLICK</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONDBLCLICK</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">1515</span> </span><span class="WHIT">						 </span><span class="NAME">DwtEvent.ONMOUSEOVER</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONMOUSEOUT</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">1516</span> </span><span class="WHIT">						 </span><span class="NAME">DwtEvent.ONMOUSEDOWN</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONMOUSEMOVE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONMOUSEUP</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1517</span> </span><span class="WHIT">	</span><span class="NAME">this.addListener</span><span class="PUNC">(</span><span class="NAME">DwtEvent.ONCLICK</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._clickListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1518</span> </span><span class="WHIT">	</span><span class="NAME">this.addListener</span><span class="PUNC">(</span><span class="NAME">DwtEvent.ONDBLCLICK</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._dblClickListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1519</span> </span><span class="WHIT">	</span><span class="NAME">this.addListener</span><span class="PUNC">(</span><span class="NAME">DwtEvent.ONMOUSEUP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._mouseUpListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1520</span> 
<span class="line">1521</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">addrInput</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1522</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dragSrc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DwtDragSource</span><span class="PUNC">(</span><span class="NAME">Dwt.DND_DROP_MOVE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1523</span> </span><span class="WHIT">		</span><span class="NAME">dragSrc.addDragListener</span><span class="PUNC">(</span><span class="NAME">this._dragListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1524</span> </span><span class="WHIT">		</span><span class="NAME">this.setDragSource</span><span class="PUNC">(</span><span class="NAME">dragSrc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1525</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1526</span> 
<span class="line">1527</span> </span><span class="WHIT">	</span><span class="NAME">this._evtMgr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AjxEventMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1528</span> </span><span class="WHIT">	</span><span class="NAME">this._selEv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DwtSelectionEvent</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1529</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1530</span> 
<span class="line">1531</span> </span><span class="NAME">ZmAddressBubble.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DwtControl</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1532</span> </span><span class="NAME">ZmAddressBubble.prototype.constructor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressBubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1533</span> 
<span class="line">1534</span> </span><span class="NAME">ZmAddressBubble.prototype.isZmAddressBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1535</span> </span><span class="NAME">ZmAddressBubble.prototype.toString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">&#34;ZmAddressBubble&#34;</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1536</span> </span><span class="NAME">ZmAddressBubble.prototype.isFocusable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1537</span> 
<span class="line">1538</span> </span><span class="NAME">ZmAddressBubble.prototype._createElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1539</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1540</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">&#34;SPAN&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1541</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1542</span> 
<span class="line">1543</span> </span><span class="NAME">ZmAddressBubble.prototype._createHtml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1544</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1545</span> 
<span class="line">1546</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getHtmlElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1547</span> </span><span class="WHIT">	</span><span class="NAME">el.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressBubble.getContent</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1548</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.parentId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1549</span> </span><span class="WHIT">		</span><span class="NAME">el._aifId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.parentId</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1550</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1551</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1552</span> 
<span class="line">1553</span> </span><span class="COMM">/**
<span class="line">1554</span>  * Returns HTML for the content of a bubble.
<span class="line">1555</span>  *
<span class="line">1556</span>  * @param {hash}				params		the hash of parameters:
<span class="line">1557</span>  * @param {ZmAddressInputField}	parent		parent control
<span class="line">1558</span>  * @param {string}				id			element ID for the bubble
<span class="line">1559</span>  * @param {string}				className	CSS class for the bubble
<span class="line">1560</span>  * @param {string}				address		email address to display in the bubble
<span class="line">1561</span>  * @param {AjxEmailAddress}		addrObj		email address (alternative form)
<span class="line">1562</span>  * @param {boolean}				canRemove	if true, an x will be provided to remove the address bubble
<span class="line">1563</span>  * @param {boolean}				canExpand	if true, a + will be provided to expand the DL address
<span class="line">1564</span>  * @param {boolean}				noParse		if true, do not parse content to see if it is an address
<span class="line">1565</span>  */</span><span class="WHIT">
<span class="line">1566</span> </span><span class="NAME">ZmAddressBubble.getContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1567</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1568</span> 
<span class="line">1569</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.id</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1570</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.addrObj</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">params.noParse</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">AjxEmailAddress.parse</span><span class="PUNC">(</span><span class="NAME">params.address</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.address</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ZmMsg.unknown</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1571</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fullAddress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxStringUtil.htmlEncode</span><span class="PUNC">(</span><span class="NAME">addrObj</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">addrObj.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.address</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1572</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">text</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxStringUtil.htmlEncode</span><span class="PUNC">(</span><span class="NAME">addrObj</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">addrObj.toString</span><span class="PUNC">(</span><span class="NAME">appCtxt.get</span><span class="PUNC">(</span><span class="NAME">ZmSetting.SHORT_ADDRESS</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.address</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1573</span> 
<span class="line">1574</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">expandLinkText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">removeLinkText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">addrStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1575</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;cursor:pointer;position:absolute;top:2px;&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1576</span> 
<span class="line">1577</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.canExpand</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1578</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.email</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.address</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1579</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">expandLinkId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;_expand&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1580</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">expandLink</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#39;ZmAddressBubble.expandBubble(&#34;&#39;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#39;&#34;,&#34;&#39;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">addr</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#39;&#34;);&#39;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1581</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">expStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;left:2px;&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1582</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">expandLinkText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxImg.getImageHtml</span><span class="PUNC">(</span><span class="STRN">&#34;BubbleExpand&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">expStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;id=&#39;&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">expandLinkId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;&#39; onclick=&#39;&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">expandLink</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;&#39;&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1583</span> </span><span class="WHIT">		</span><span class="NAME">addrStyle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;padding-left:12px;&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1584</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1585</span> 
<span class="line">1586</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.canRemove</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1587</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">removeLinkId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;_remove&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1588</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">removeLink</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#39;ZmAddressInputField.removeBubble(&#34;&#39;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#39;&#34;);&#39;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1589</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">removeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;right:2px;&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1590</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">removeLinkText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxImg.getImageHtml</span><span class="PUNC">(</span><span class="STRN">&#34;BubbleDelete&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">removeStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;id=&#39;&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">removeLinkId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;&#39; onclick=&#39;&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">removeLink</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;&#39;&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1591</span> </span><span class="WHIT">		</span><span class="NAME">addrStyle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;padding-right:12px;&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1592</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1593</span> </span><span class="WHIT">	
<span class="line">1594</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1595</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrStyleText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.canExpand</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.canRemove</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">&#34; style=&#39;&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">addrStyle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;&#39;&#34;</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">&#34;&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1596</span> </span><span class="WHIT">	</span><span class="NAME">html</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;&lt;span&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">addrStyleText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;&gt;&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">text</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34; &lt;/span&gt;&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1597</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">html.join</span><span class="PUNC">(</span><span class="STRN">&#34;&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1598</span> 
<span class="line">1599</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">expandLinkText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">addrText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">removeLinkText</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1600</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1601</span> 
<span class="line">1602</span> 
<span class="line">1603</span> </span><span class="COMM">/**
<span class="line">1604</span>  * Gets the key map name.
<span class="line">1605</span>  * 
<span class="line">1606</span>  * @return	{string}	the key map name
<span class="line">1607</span>  */</span><span class="WHIT">
<span class="line">1608</span> </span><span class="NAME">ZmAddressBubble.prototype.getKeyMapName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1609</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1610</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">DwtKeyMap.MAP_BUTTON</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1611</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1612</span> 
<span class="line">1613</span> </span><span class="COMM">/**
<span class="line">1614</span>  * Handles a key action event.
<span class="line">1615</span>  * 
<span class="line">1616</span>  * @param	{constant}		actionCode		the action code (see {@link DwtKeyMap})
<span class="line">1617</span>  * @param	{DwtEvent}		ev		the event
<span class="line">1618</span>  * @return	{boolean}		&lt;code&gt;true&lt;/code&gt; if the event is handled; &lt;code&gt;false&lt;/code&gt; otherwise
<span class="line">1619</span>  * @see		DwtKeyMap
<span class="line">1620</span>  */</span><span class="WHIT">
<span class="line">1621</span> </span><span class="NAME">ZmAddressBubble.prototype.handleKeyAction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1622</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">actionCode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1623</span> </span><span class="WHIT">	</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">actionCode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1624</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">DwtKeyMap.SELECT</span><span class="PUNC">:</span><span class="WHIT">
<span class="line">1625</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">DwtKeyMap.SUBMENU</span><span class="PUNC">:</span><span class="WHIT">
<span class="line">1626</span> </span><span class="WHIT">			</span><span class="NAME">this.list._itemActioned</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1627</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1628</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1629</span> 
<span class="line">1630</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1631</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1632</span> 
<span class="line">1633</span> </span><span class="COMM">/**
<span class="line">1634</span>  * Adds a selection listener.
<span class="line">1635</span>  * 
<span class="line">1636</span>  * @param	{AjxListener}	listener		the listener
<span class="line">1637</span>  */</span><span class="WHIT">
<span class="line">1638</span> </span><span class="NAME">ZmAddressBubble.prototype.addSelectionListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1639</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1640</span> </span><span class="WHIT">	</span><span class="NAME">this._evtMgr.addListener</span><span class="PUNC">(</span><span class="NAME">DwtEvent.SELECTION</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1641</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1642</span> 
<span class="line">1643</span> </span><span class="COMM">/**
<span class="line">1644</span>  * Removes a selection listener.
<span class="line">1645</span>  * 
<span class="line">1646</span>  * @param	{AjxListener}	listener		the listener
<span class="line">1647</span>  */</span><span class="WHIT">
<span class="line">1648</span> </span><span class="NAME">ZmAddressBubble.prototype.removeSelectionListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1649</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1650</span> </span><span class="WHIT">	</span><span class="NAME">this._evtMgr.removeListener</span><span class="PUNC">(</span><span class="NAME">DwtEvent.SELECTION</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1651</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1652</span> 
<span class="line">1653</span> </span><span class="NAME">ZmAddressBubble.prototype._clickListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1654</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1655</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.list</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._dragging</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtControl._NO_DRAG</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1656</span> </span><span class="WHIT">		</span><span class="NAME">this.list._itemClicked</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1657</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1658</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._evtMgr.isListenerRegistered</span><span class="PUNC">(</span><span class="NAME">DwtEvent.SELECTION</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1659</span> </span><span class="WHIT">		</span><span class="NAME">DwtUiEvent.copy</span><span class="PUNC">(</span><span class="NAME">this._selEv</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1660</span> </span><span class="WHIT">		</span><span class="NAME">this._selEv.item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1661</span> </span><span class="WHIT">		</span><span class="NAME">this._selEv.detail</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONCLICK</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1662</span> </span><span class="WHIT">		</span><span class="NAME">this._evtMgr.notifyListeners</span><span class="PUNC">(</span><span class="NAME">DwtEvent.SELECTION</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._selEv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1663</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1664</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1665</span> 
<span class="line">1666</span> </span><span class="NAME">ZmAddressBubble.prototype._dblClickListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1667</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1668</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1669</span> </span><span class="WHIT">	</span><span class="NAME">this.list._itemDoubleClicked</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1670</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1671</span> 
<span class="line">1672</span> </span><span class="NAME">ZmAddressBubble.prototype._mouseUpListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1673</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1674</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1675</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.button</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtMouseEvent.RIGHT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1676</span> </span><span class="WHIT">		</span><span class="NAME">this.list._itemActioned</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1677</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1678</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1679</span> 
<span class="line">1680</span> </span><span class="NAME">ZmAddressBubble.prototype._getDragProxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1681</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dragOp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1682</span> 
<span class="line">1683</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">icon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">&#34;div&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1684</span> </span><span class="WHIT">	</span><span class="NAME">icon.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._className</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1685</span> </span><span class="WHIT">	</span><span class="NAME">Dwt.setPosition</span><span class="PUNC">(</span><span class="NAME">icon</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Dwt.ABSOLUTE_STYLE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1686</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.addrInput.getSelectionCount</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1687</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1688</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1689</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxEmailAddress.parse</span><span class="PUNC">(</span><span class="NAME">this.address</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.address</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ZmMsg.unknown</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1690</span> </span><span class="WHIT">		</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxStringUtil.htmlEncode</span><span class="PUNC">(</span><span class="NAME">addrObj</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">addrObj.toString</span><span class="PUNC">(</span><span class="NAME">appCtxt.get</span><span class="PUNC">(</span><span class="NAME">ZmSetting.SHORT_ADDRESS</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.address</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1691</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1692</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1693</span> </span><span class="WHIT">		</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AjxMessageFormat.format</span><span class="PUNC">(</span><span class="NAME">ZmMsg.numAddresses</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1694</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1695</span> </span><span class="WHIT">	</span><span class="NAME">icon.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1696</span> </span><span class="WHIT">	</span><span class="NAME">this.shell.getHtmlElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">appendChild</span><span class="PUNC">(</span><span class="NAME">icon</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1697</span> </span><span class="WHIT">	</span><span class="NAME">Dwt.setZIndex</span><span class="PUNC">(</span><span class="NAME">icon</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Dwt.Z_DND</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1698</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">icon</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1699</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1700</span> 
<span class="line">1701</span> </span><span class="NAME">ZmAddressBubble.prototype._dragListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1702</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1703</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.action</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtDragEvent.SET_DATA</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1704</span> </span><span class="WHIT">		</span><span class="NAME">ev.srcData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">selection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.addrInput.getSelection</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">1705</span> </span><span class="WHIT">					  </span><span class="NAME">addrInput</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.addrInput</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1706</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1707</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1708</span> 
<span class="line">1709</span> </span><span class="NAME">ZmAddressBubble.prototype._dragOver</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1710</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1711</span> </span><span class="WHIT">	</span><span class="NAME">this.addrInput._dragOver</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1712</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1713</span> 
<span class="line">1714</span> </span><span class="COMM">/**
<span class="line">1715</span>  * Gets the tool tip content.
<span class="line">1716</span>  * 
<span class="line">1717</span>  * @param	{Object}	ev		the hover event
<span class="line">1718</span>  * @return	{String}	the tool tip content
<span class="line">1719</span>  */</span><span class="WHIT">
<span class="line">1720</span> </span><span class="NAME">ZmAddressBubble.prototype.getToolTipContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1721</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1722</span> 
<span class="line">1723</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ttParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">address</span><span class="PUNC">:</span><span class="NAME">this.addrObj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">:</span><span class="NAME">ev</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1724</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ttCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AjxCallback</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">1725</span> </span><span class="WHIT">		</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1726</span> </span><span class="WHIT">			</span><span class="NAME">appCtxt.getToolTipMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getToolTip</span><span class="PUNC">(</span><span class="NAME">ZmToolTipMgr.PERSON</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ttParams</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1727</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1728</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">callback</span><span class="PUNC">:</span><span class="NAME">ttCallback</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1729</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1730</span> 
<span class="line">1731</span> </span><span class="COMM">// Bug 78359 - hack so that shortcuts work even though browser focus is on hidden textarea</span><span class="WHIT">
<span class="line">1732</span> </span><span class="NAME">ZmAddressBubble.prototype.hasFocus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1733</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1734</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1735</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1736</span> 
<span class="line">1737</span> </span><span class="COMM">/**
<span class="line">1738</span>  * Expands the distribution list address of the bubble with the given ID.
<span class="line">1739</span>  *
<span class="line">1740</span>  * @param {string}	bubbleId	ID of bubble
<span class="line">1741</span>  * @param {string}	email		address to expand
<span class="line">1742</span>  */</span><span class="WHIT">
<span class="line">1743</span> </span><span class="NAME">ZmAddressBubble.expandBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubbleId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">email</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1744</span> 
<span class="line">1745</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">bubbleId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1746</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1747</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parentId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble._aifId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ZmAddressInputField.BUBBLE_OBJ_ID</span><span class="PUNC">[</span><span class="NAME">bubbleId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1748</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">DwtControl.ALL_BY_ID</span><span class="PUNC">[</span><span class="NAME">parentId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1749</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">parent.getEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">parent._aclv</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1750</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubbleObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtControl.fromElementId</span><span class="PUNC">(</span><span class="NAME">bubbleId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1751</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bubbleObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1752</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubbleObj.getLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1753</span> </span><span class="WHIT">				</span><span class="NAME">loc.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubbleObj.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1754</span> </span><span class="WHIT">				</span><span class="NAME">parent._aclv.expandDL</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1755</span> </span><span class="WHIT">					</span><span class="NAME">email</span><span class="PUNC">:</span><span class="WHIT">      </span><span class="NAME">email</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">1756</span> </span><span class="WHIT">					</span><span class="NAME">loc</span><span class="PUNC">:</span><span class="WHIT">        </span><span class="NAME">loc</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">1757</span> </span><span class="WHIT">					</span><span class="NAME">element</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="NAME">parent._input</span><span class="WHIT">
<span class="line">1758</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1759</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1760</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1761</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1762</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1763</span> 
<span class="line">1764</span> 
<span class="line">1765</span> 
<span class="line">1766</span> </span><span class="COMM">/**
<span class="line">1767</span>  * Creates an empty bubble list.
<span class="line">1768</span>  * @constructor
<span class="line">1769</span>  * @class
<span class="line">1770</span>  * This class manages selection events (click, double-click, and right-click) of a collection of bubbles, since
<span class="line">1771</span>  * those events are typically meaningful within a group of bubbles. It maintains the visual state of the bubble
<span class="line">1772</span>  * and notifies any listeners of the selection events. 
<span class="line">1773</span>  * 
<span class="line">1774</span>  * @param {hash}				params			hash of params:
<span class="line">1775</span>  * @param {ZmAddressInputField}	parent			parent
<span class="line">1776</span>  * @param {string}				normalClass		class for an unselected bubble
<span class="line">1777</span>  * @param {string}				selClass		class for a selected bubble
<span class="line">1778</span>  * @param {string}				rightSelClass	class for a right-clicked bubble
<span class="line">1779</span>  */</span><span class="WHIT">
<span class="line">1780</span> </span><span class="NAME">ZmAddressBubbleList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1781</span> </span><span class="WHIT">	
<span class="line">1782</span> 	</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1783</span> </span><span class="WHIT">	</span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.parent</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1784</span> </span><span class="WHIT">	</span><span class="NAME">this._separator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.separator</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">AjxEmailAddress.SEPARATOR</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1785</span> </span><span class="WHIT">	
<span class="line">1786</span> 	</span><span class="NAME">this._normalClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.normalClass</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">&#34;addrBubble&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1787</span> </span><span class="WHIT">	</span><span class="NAME">this._selClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.selClass</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._normalClass</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;-&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">DwtCssStyle.SELECTED</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1788</span> </span><span class="WHIT">	</span><span class="NAME">this._actionClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.rightSelClass</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._normalClass</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;-&#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">DwtCssStyle.ACTIONED</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1789</span> 
<span class="line">1790</span> </span><span class="WHIT">	</span><span class="NAME">this._evtMgr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AjxEventMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1791</span> </span><span class="WHIT">	</span><span class="NAME">this._selEv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DwtSelectionEvent</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1792</span> </span><span class="WHIT">	</span><span class="NAME">this._actionEv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DwtListViewActionEvent</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1793</span> 
<span class="line">1794</span> </span><span class="WHIT">	</span><span class="NAME">this.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1795</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1796</span> 
<span class="line">1797</span> </span><span class="NAME">ZmAddressBubbleList.prototype.isZmAddressBubbleList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1798</span> </span><span class="NAME">ZmAddressBubbleList.prototype.toString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">&#34;ZmAddressBubbleList&#34;</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1799</span> 
<span class="line">1800</span> </span><span class="NAME">ZmAddressBubbleList.prototype.set</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1801</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1802</span> </span><span class="WHIT">	
<span class="line">1803</span> 	</span><span class="NAME">this._bubbleList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1804</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1805</span> </span><span class="WHIT">	</span><span class="NAME">this._numSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1806</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1807</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1808</span> </span><span class="WHIT">		</span><span class="NAME">this._bubbleList.push</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1809</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._selected</span><span class="PUNC">[</span><span class="NAME">bubble.id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1810</span> </span><span class="WHIT">			</span><span class="NAME">selected</span><span class="PUNC">[</span><span class="NAME">bubble.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1811</span> </span><span class="WHIT">			</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;ZmAddressBubbleList::set - bubble selected: &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">bubble.address</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1812</span> </span><span class="WHIT">			</span><span class="NAME">this._numSelected</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1813</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1814</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1815</span> </span><span class="WHIT">	</span><span class="NAME">this._selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="PUNC">;</span><span class="WHIT"> 
<span class="line">1816</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1817</span> 
<span class="line">1818</span> </span><span class="NAME">ZmAddressBubbleList.prototype.getArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1819</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1820</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._bubbleList</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1821</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1822</span> 
<span class="line">1823</span> </span><span class="NAME">ZmAddressBubbleList.prototype.add</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1824</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1825</span> </span><span class="WHIT">	</span><span class="NAME">AjxUtil.arrayAdd</span><span class="PUNC">(</span><span class="NAME">this._bubbleList</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1826</span> </span><span class="WHIT">	</span><span class="NAME">bubble.list</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1827</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1828</span> 
<span class="line">1829</span> </span><span class="NAME">ZmAddressBubbleList.prototype.remove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1830</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1831</span> </span><span class="WHIT">	</span><span class="NAME">AjxUtil.arrayRemove</span><span class="PUNC">(</span><span class="NAME">this._bubbleList</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1832</span> </span><span class="WHIT">	</span><span class="NAME">bubble.list</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1833</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._selected</span><span class="PUNC">[</span><span class="NAME">bubble.id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1834</span> </span><span class="WHIT">		</span><span class="NAME">this._numSelected</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1835</span> </span><span class="WHIT">		</span><span class="NAME">this._selected</span><span class="PUNC">[</span><span class="NAME">bubble.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1836</span> </span><span class="WHIT">		</span><span class="NAME">this._checkSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1837</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1838</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this._rightSelBubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1839</span> </span><span class="WHIT">		</span><span class="NAME">this._rightSelBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1840</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1841</span> </span><span class="WHIT">	</span><span class="NAME">bubble.dispose</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1842</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1843</span> 
<span class="line">1844</span> </span><span class="NAME">ZmAddressBubbleList.prototype.clear</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1845</span> </span><span class="WHIT">	</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._bubbleList.length</span><span class="WHIT"> </span><span class="PUNC">&gt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1846</span> </span><span class="WHIT">		</span><span class="NAME">this.remove</span><span class="PUNC">(</span><span class="NAME">this._bubbleList</span><span class="PUNC">[</span><span class="NAME">this._bubbleList.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1847</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1848</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1849</span> 
<span class="line">1850</span> </span><span class="NAME">ZmAddressBubbleList.prototype.getBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1851</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1852</span> </span><span class="WHIT">	</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1853</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._bubbleList</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1854</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1855</span> 
<span class="line">1856</span> </span><span class="COMM">/**
<span class="line">1857</span>  * Adds a selection listener.
<span class="line">1858</span>  * 
<span class="line">1859</span>  * @param	{AjxListener}	listener		the listener
<span class="line">1860</span>  */</span><span class="WHIT">
<span class="line">1861</span> </span><span class="NAME">ZmAddressBubbleList.prototype.addSelectionListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1862</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1863</span> </span><span class="WHIT">	</span><span class="NAME">this._evtMgr.addListener</span><span class="PUNC">(</span><span class="NAME">DwtEvent.SELECTION</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1864</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1865</span> 
<span class="line">1866</span> </span><span class="COMM">/**
<span class="line">1867</span>  * Removes a selection listener.
<span class="line">1868</span>  * 
<span class="line">1869</span>  * @param	{AjxListener}	listener		the listener
<span class="line">1870</span>  */</span><span class="WHIT">
<span class="line">1871</span> </span><span class="NAME">ZmAddressBubbleList.prototype.removeSelectionListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1872</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1873</span> </span><span class="WHIT">	</span><span class="NAME">this._evtMgr.removeListener</span><span class="PUNC">(</span><span class="NAME">DwtEvent.SELECTION</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1874</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1875</span> 
<span class="line">1876</span> </span><span class="COMM">/**
<span class="line">1877</span>  * Adds an action listener.
<span class="line">1878</span>  * 
<span class="line">1879</span>  * @param	{AjxListener}	listener		the listener
<span class="line">1880</span>  */</span><span class="WHIT">
<span class="line">1881</span> </span><span class="NAME">ZmAddressBubbleList.prototype.addActionListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1882</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1883</span> </span><span class="WHIT">	</span><span class="NAME">this._evtMgr.addListener</span><span class="PUNC">(</span><span class="NAME">DwtEvent.ACTION</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1884</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1885</span> 
<span class="line">1886</span> </span><span class="COMM">/**
<span class="line">1887</span>  * Removes an action listener.
<span class="line">1888</span>  * 
<span class="line">1889</span>  * @param	{AjxListener}	listener		the listener
<span class="line">1890</span>  */</span><span class="WHIT">
<span class="line">1891</span> </span><span class="NAME">ZmAddressBubbleList.prototype.removeActionListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1892</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1893</span> </span><span class="WHIT">	</span><span class="NAME">this._evtMgr.removeListener</span><span class="PUNC">(</span><span class="NAME">DwtEvent.ACTION</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1894</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1895</span> 
<span class="line">1896</span> </span><span class="NAME">ZmAddressBubbleList.prototype._itemClicked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1897</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1898</span> 
<span class="line">1899</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.shiftKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1900</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._lastSelectedId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1901</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">select</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1902</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._bubbleList.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1903</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._bubbleList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1904</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">b.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this._lastSelectedId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1905</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">select</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1906</span> </span><span class="WHIT">						</span><span class="NAME">this.setSelected</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1907</span> </span><span class="WHIT">						</span><span class="NAME">select</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1908</span> </span><span class="WHIT">						</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1909</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1910</span> </span><span class="WHIT">					</span><span class="NAME">select</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">select</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1911</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1912</span> </span><span class="WHIT">				</span><span class="NAME">this.setSelected</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">select</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1913</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1914</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1915</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1916</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ev.ctrlKey</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ev.metaKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1917</span> </span><span class="WHIT">		</span><span class="NAME">this.setSelected</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this._selected</span><span class="PUNC">[</span><span class="NAME">bubble.id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1918</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._selected</span><span class="PUNC">[</span><span class="NAME">bubble.id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1919</span> </span><span class="WHIT">			</span><span class="NAME">this._lastSelectedId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble.id</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1920</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1921</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1922</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1923</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wasOnlyOneSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.getSelectionCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._selected</span><span class="PUNC">[</span><span class="NAME">bubble.id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1924</span> </span><span class="WHIT">		</span><span class="NAME">this.deselectAll</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1925</span> </span><span class="WHIT">		</span><span class="NAME">this.setSelected</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">wasOnlyOneSelected</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1926</span> </span><span class="WHIT">		</span><span class="NAME">this._lastSelectedId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wasOnlyOneSelected</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">bubble.id</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1927</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1928</span> 
<span class="line">1929</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._evtMgr.isListenerRegistered</span><span class="PUNC">(</span><span class="NAME">DwtEvent.SELECTION</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1930</span> </span><span class="WHIT">		</span><span class="NAME">DwtUiEvent.copy</span><span class="PUNC">(</span><span class="NAME">this._selEv</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1931</span> </span><span class="WHIT">		</span><span class="NAME">this._selEv.item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1932</span> </span><span class="WHIT">		</span><span class="NAME">this._selEv.detail</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONCLICK</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1933</span> </span><span class="WHIT">		</span><span class="NAME">this._evtMgr.notifyListeners</span><span class="PUNC">(</span><span class="NAME">DwtEvent.SELECTION</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._selEv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1934</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1935</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1936</span> 
<span class="line">1937</span> </span><span class="NAME">ZmAddressBubbleList.prototype._itemDoubleClicked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1938</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1939</span> 
<span class="line">1940</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._evtMgr.isListenerRegistered</span><span class="PUNC">(</span><span class="NAME">DwtEvent.SELECTION</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1941</span> </span><span class="WHIT">		</span><span class="NAME">DwtUiEvent.copy</span><span class="PUNC">(</span><span class="NAME">this._selEv</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1942</span> </span><span class="WHIT">		</span><span class="NAME">this._selEv.item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1943</span> </span><span class="WHIT">		</span><span class="NAME">this._selEv.detail</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DwtEvent.ONDBLCLICK</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1944</span> </span><span class="WHIT">		</span><span class="NAME">this._evtMgr.notifyListeners</span><span class="PUNC">(</span><span class="NAME">DwtEvent.SELECTION</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._selEv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1945</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1946</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1947</span> 
<span class="line">1948</span> </span><span class="NAME">ZmAddressBubbleList.prototype._itemActioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1949</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1950</span> 
<span class="line">1951</span> </span><span class="WHIT">	</span><span class="NAME">this._rightSelBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1952</span> </span><span class="WHIT">	</span><span class="NAME">bubble.setClassName</span><span class="PUNC">(</span><span class="NAME">this._actionClass</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1953</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._evtMgr.isListenerRegistered</span><span class="PUNC">(</span><span class="NAME">DwtEvent.ACTION</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1954</span> </span><span class="WHIT">		</span><span class="NAME">DwtUiEvent.copy</span><span class="PUNC">(</span><span class="NAME">this._actionEv</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1955</span> </span><span class="WHIT">		</span><span class="NAME">this._actionEv.item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1956</span> </span><span class="WHIT">		</span><span class="NAME">this._evtMgr.notifyListeners</span><span class="PUNC">(</span><span class="NAME">DwtEvent.ACTION</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._actionEv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1957</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1958</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1959</span> 
<span class="line">1960</span> </span><span class="COMM">/**
<span class="line">1961</span>  * Sets selection of the given bubble.
<span class="line">1962</span>  *
<span class="line">1963</span>  * @param {ZmAddressBubble}	bubble		bubble to select
<span class="line">1964</span>  * @param {boolean} 		selected	if true, select the bubble, otherwise deselect it
<span class="line">1965</span>  */</span><span class="WHIT">
<span class="line">1966</span> </span><span class="NAME">ZmAddressBubbleList.prototype.setSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1967</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1968</span> 
<span class="line">1969</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1970</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Boolean</span><span class="PUNC">(</span><span class="NAME">this._selected</span><span class="PUNC">[</span><span class="NAME">bubble.id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">1971</span> 
<span class="line">1972</span> </span><span class="WHIT">	</span><span class="NAME">this._selected</span><span class="PUNC">[</span><span class="NAME">bubble.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1973</span> </span><span class="WHIT">	</span><span class="NAME">bubble.setClassName</span><span class="PUNC">(</span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this._selClass</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this._normalClass</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1974</span> 
<span class="line">1975</span> </span><span class="WHIT">	</span><span class="NAME">this._numSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this._numSelected</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this._numSelected</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1976</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;**** selected: &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;, &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">bubble.email</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">&#34;, num = &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this._numSelected</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1977</span> </span><span class="WHIT">	</span><span class="NAME">this._checkSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	
<span class="line">1978</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1979</span> 
<span class="line">1980</span> </span><span class="NAME">ZmAddressBubbleList.prototype.isSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1981</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1982</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Boolean</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._selected</span><span class="PUNC">[</span><span class="NAME">bubble.id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1983</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1984</span> 
<span class="line">1985</span> </span><span class="COMM">/**
<span class="line">1986</span>  * Returns a list of the currently selected bubbles. If a bubble has been selected via right-click,
<span class="line">1987</span>  * but is not part of the current left-click selection, only it will be returned.
<span class="line">1988</span>  *
<span class="line">1989</span>  * @param {ZmAddressBubble}	bubble	reference bubble
<span class="line">1990</span>  */</span><span class="WHIT">
<span class="line">1991</span> </span><span class="NAME">ZmAddressBubbleList.prototype.getSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">1992</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1993</span> 
<span class="line">1994</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ref</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._rightSelBubble</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1995</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">refIncluded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1996</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1997</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this._bubbleList.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">1998</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._bubbleList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">1999</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._selected</span><span class="PUNC">[</span><span class="NAME">bubble.id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2000</span> </span><span class="WHIT">			</span><span class="NAME">sel.push</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2001</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ref</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2002</span> </span><span class="WHIT">				</span><span class="NAME">refIncluded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2003</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">2004</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">2005</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">2006</span> </span><span class="WHIT">	</span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ref</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">refIncluded</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">ref</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2007</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;getSelection, sel length: &#34;</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sel.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2008</span> 
<span class="line">2009</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2010</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2011</span> 
<span class="line">2012</span> </span><span class="NAME">ZmAddressBubbleList.prototype.getSelectionCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">2013</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2014</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">bubble</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.getSelection</span><span class="PUNC">(</span><span class="NAME">bubble</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this._numSelected</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2015</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2016</span> 
<span class="line">2017</span> </span><span class="NAME">ZmAddressBubbleList.prototype.deselectAll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">2018</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2019</span> </span><span class="WHIT">	</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;deselectAll&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2020</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2021</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2022</span> </span><span class="WHIT">		</span><span class="NAME">this.setSelected</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2023</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">2024</span> </span><span class="WHIT">	</span><span class="NAME">this._selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2025</span> </span><span class="WHIT">	</span><span class="NAME">this._numSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2026</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2027</span> 
<span class="line">2028</span> </span><span class="NAME">ZmAddressBubbleList.prototype.clearRightSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">2029</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2030</span> </span><span class="WHIT">	</span><span class="NAME">this._rightSelBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2031</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2032</span> 
<span class="line">2033</span> </span><span class="NAME">ZmAddressBubbleList.prototype.reset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">2034</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2035</span> </span><span class="WHIT">	</span><span class="NAME">this._bubbleList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2036</span> </span><span class="WHIT">	</span><span class="NAME">this._selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2037</span> </span><span class="WHIT">	</span><span class="NAME">this._numSelected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2038</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2039</span> 
<span class="line">2040</span> </span><span class="NAME">ZmAddressBubbleList.prototype.size</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">2041</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2042</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._bubbleList.length</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2043</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2044</span> 
<span class="line">2045</span> </span><span class="NAME">ZmAddressBubbleList.prototype.selectAddressText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">2046</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2047</span> </span><span class="WHIT">	
<span class="line">2048</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2049</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2050</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sel.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2051</span> </span><span class="WHIT">		</span><span class="NAME">addrs.push</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">address</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2052</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">2053</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">textarea</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._getTextarea</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2054</span> </span><span class="WHIT">	</span><span class="NAME">textarea.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addrs.join</span><span class="PUNC">(</span><span class="NAME">this._separator</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this._separator</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2055</span> </span><span class="WHIT">	</span><span class="NAME">textarea.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2056</span> </span><span class="WHIT">	</span><span class="NAME">textarea.select</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2057</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2058</span> 
<span class="line">2059</span> </span><span class="NAME">ZmAddressBubbleList.prototype._getTextarea</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">2060</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2061</span> </span><span class="WHIT">	</span><span class="COMM">// hidden textarea used for copying address text</span><span class="WHIT">
<span class="line">2062</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ZmAddressBubbleList._textarea</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2063</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ZmAddressBubbleList._textarea</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">&#34;textarea&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2064</span> </span><span class="WHIT">		</span><span class="NAME">el.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;abcb&#34;</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// address bubble clipboard</span><span class="WHIT">
<span class="line">2065</span> </span><span class="WHIT">		</span><span class="NAME">el</span><span class="PUNC">[</span><span class="STRN">&#34;data-hidden&#34;</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">&#34;1&#34;</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2066</span> </span><span class="WHIT">		</span><span class="NAME">appCtxt.getShell</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getHtmlElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">appendChild</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2067</span> </span><span class="WHIT">		</span><span class="NAME">Dwt.setPosition</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Dwt.ABSOLUTE_STYLE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2068</span> </span><span class="WHIT">		</span><span class="NAME">Dwt.setLocation</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Dwt.LOC_NOWHERE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Dwt.LOC_NOWHERE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2069</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">2070</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ZmAddressBubbleList._textarea</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2071</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2072</span> 
<span class="line">2073</span> </span><span class="NAME">ZmAddressBubbleList.prototype._checkSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">2074</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2075</span> 
<span class="line">2076</span> </span><span class="WHIT">	</span><span class="COMM">// don&#39;t mess with outside listening if we&#39;re selecting via rubber-banding</span><span class="WHIT">
<span class="line">2077</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.parent._noOutsideListening</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.parent._dragging</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DwtControl._DRAGGING</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class="line">2078</span> 
<span class="line">2079</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._listening</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._numSelected</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2080</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">omem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">appCtxt.getOutsideMouseEventMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2081</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">omemParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2082</span> </span><span class="WHIT">			</span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT">					</span><span class="STRN">&#34;ZmAddressBubbleList&#34;</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">2083</span> </span><span class="WHIT">			</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="WHIT">			</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="COMM">// all clicks call our listener</span><span class="WHIT">
<span class="line">2084</span> </span><span class="WHIT">			</span><span class="NAME">outsideListener</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">this._outsideMouseListener.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">2085</span> </span><span class="WHIT">			</span><span class="NAME">noWindowBlur</span><span class="PUNC">:</span><span class="WHIT">		</span><span class="NAME">appCtxt.get</span><span class="PUNC">(</span><span class="NAME">ZmSetting.IS_DEV_SERVER</span><span class="PUNC">)</span><span class="WHIT">
<span class="line">2086</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">2087</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;START outside listening for bubbles&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2088</span> </span><span class="WHIT">		</span><span class="NAME">omem.startListening</span><span class="PUNC">(</span><span class="NAME">omemParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2089</span> </span><span class="WHIT">		</span><span class="NAME">this._listening</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2090</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">2091</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._listening</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="NAME">this._numSelected</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2092</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">omem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">appCtxt.getOutsideMouseEventMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2093</span> </span><span class="WHIT">		</span><span class="NAME">DBG.println</span><span class="PUNC">(</span><span class="STRN">&#34;aif&#34;</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">&#34;STOP outside listening for bubbles&#34;</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2094</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">omemParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2095</span> </span><span class="WHIT">			</span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT">			</span><span class="STRN">&#34;ZmAddressBubbleList&#34;</span><span class="PUNC">,</span><span class="WHIT">
<span class="line">2096</span> </span><span class="WHIT">			</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="KEYW">null</span><span class="WHIT">
<span class="line">2097</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">		
<span class="line">2098</span> 		</span><span class="NAME">omem.stopListening</span><span class="PUNC">(</span><span class="NAME">omemParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2099</span> </span><span class="WHIT">		</span><span class="NAME">this._listening</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2100</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">2101</span> </span><span class="WHIT">	</span><span class="NAME">this.selectAddressText</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2102</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2103</span> 
<span class="line">2104</span> </span><span class="NAME">ZmAddressBubbleList.prototype._outsideMouseListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">
<span class="line">2105</span> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2106</span> 
<span class="line">2107</span> </span><span class="WHIT">	</span><span class="COMM">// modified clicks control list selection, ignore them</span><span class="WHIT">
<span class="line">2108</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ev.shiftKey</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">ev.ctrlKey</span><span class="WHIT"> </span><span class="PUNC">&amp;&amp;</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">ev.metaKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class="line">2109</span> </span><span class="WHIT">		</span><span class="NAME">this.deselectAll</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2110</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class="line">2111</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class="line">2112</span> </span></pre></body></html>